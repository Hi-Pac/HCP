<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دلتا للدهانات - نظام إدارة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#6B7280',
                    },
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap');
        * {
            font-family: 'Cairo', sans-serif;
        }
        body {
            background-color: #f3f4f6;
        }
        .dark body {
            background-color: #181818;
        }
        :root {
            --primary-color: #5D5CDE;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Support for dark mode */
        .dark .bg-white {
            background-color: #1f2937;
        }
        .dark .text-gray-700 {
            color: #e5e7eb;
        }
        .dark .text-gray-600 {
            color: #d1d5db;
        }
        .dark .text-gray-500 {
            color: #9ca3af;
        }
        .dark .border-gray-300 {
            border-color: #4b5563;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <!-- Login Container -->
    <div class="max-w-md w-full bg-white rounded-lg shadow-md overflow-hidden" id="auth-container">
        <!-- Login Page -->
        <div id="login-page" class="p-8">
            <div class="flex justify-center mb-6">
                <img src="https://pfst.cf2.poecdn.net/base/image/730df5b328486675766f4250c857a17437fe5cd5174c948a2e4ffea07c235d79?w=200" alt="HCP Points" class="h-14">
            </div>
            <h2 class="text-2xl font-semibold text-center mb-6 text-gray-700">تسجيل الدخول</h2>
            <form id="login-form">
                <div class="mb-4">
                    <input id="login-email" type="email" placeholder="البريد الإلكتروني" class="w-full px-4 py-3 text-base rounded-md border border-gray-300 focus:outline-none focus:border-primary" required>
                </div>
                <div class="mb-6">
                    <input id="login-password" type="password" placeholder="كلمة المرور" class="w-full px-4 py-3 text-base rounded-md border border-gray-300 focus:outline-none focus:border-primary" required>
                </div>
                <div class="flex items-center mb-6">
                    <input id="remember-me" type="checkbox" class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary">
                    <label for="remember-me" class="mr-2 block text-sm text-gray-600">تذكرني</label>
                </div>
                <button type="submit" id="login-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-md focus:outline-none transition duration-200">
                    <span>تسجيل الدخول</span>
                    <span class="loading hidden"></span>
                </button>
                <button type="button" id="register-redirect" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-md mt-3 focus:outline-none transition duration-200">إنشاء حساب</button>
            </form>
        </div>

        <!-- Registration Page -->
        <div id="register-page" class="p-8 hidden">
            <div class="flex justify-center mb-6">
                <img src="https://pfst.cf2.poecdn.net/base/image/730df5b328486675766f4250c857a17437fe5cd5174c948a2e4ffea07c235d79?w=200" alt="HCP Points" class="h-14">
            </div>
            <h2 class="text-2xl font-semibold text-center mb-6 text-gray-700">إنشاء حساب جديد</h2>
            <form id="register-form">
                <div class="mb-4">
                    <input id="register-name" type="text" placeholder="الاسم" class="w-full px-4 py-3 text-base rounded-md border border-gray-300 focus:outline-none focus:border-primary" required>
                </div>
                <div class="mb-4">
                    <input id="register-email" type="email" placeholder="البريد الإلكتروني" class="w-full px-4 py-3 text-base rounded-md border border-gray-300 focus:outline-none focus:border-primary" required>
                </div>
                <div class="mb-6">
                    <input id="register-password" type="password" placeholder="كلمة المرور" class="w-full px-4 py-3 text-base rounded-md border border-gray-300 focus:outline-none focus:border-primary" required minlength="6">
                </div>
                <button type="submit" id="register-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-md focus:outline-none transition duration-200">
                    <span>إنشاء حساب</span>
                    <span class="loading hidden"></span>
                </button>
                <button type="button" id="login-redirect" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-md mt-3 focus:outline-none transition duration-200">العودة إلى تسجيل الدخول</button>
            </form>
        </div>

        <div class="text-center text-gray-500 text-sm pb-4">© 2025</div>
    </div>

    <!-- Dashboard Page (Will be hidden until login) -->
    <div id="dashboard-container" class="hidden w-full h-screen">
        <!-- Sidebar and content will be added here -->
        <div class="flex h-full">
            <!-- Sidebar -->
            <div id="sidebar" class="w-64 bg-gray-800 text-white h-full flex-shrink-0 shadow-lg transform transition-transform duration-300 overflow-y-auto">
                <div class="p-4 border-b border-gray-700">
                    <img src="https://pfst.cf2.poecdn.net/base/image/730df5b328486675766f4250c857a17437fe5cd5174c948a2e4ffea07c235d79?w=200" alt="HCP Points" class="h-10 mx-auto">
                </div>
                <div class="p-4 border-b border-gray-700">
                    <p class="font-medium text-center" id="user-name">مرحباً، المستخدم</p>
                    <p class="text-xs text-gray-400 text-center" id="user-role">صلاحيات: مستخدم</p>
                </div>
                <nav class="mt-4">
                    <ul>
                        <li>
                            <a href="#dashboard" class="nav-link active flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">dashboard</span>
                                <span>لوحة التحكم</span>
                            </a>
                        </li>
                        <li>
                            <a href="#products" class="nav-link flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">inventory_2</span>
                                <span>المنتجات</span>
                            </a>
                        </li>
                        <li>
                            <a href="#customers" class="nav-link flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">people</span>
                                <span>العملاء</span>
                            </a>
                        </li>
                        <li>
                            <a href="#invoices" class="nav-link flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">receipt</span>
                                <span>الفواتير</span>
                            </a>
                        </li>
                        <li>
                            <a href="#returns" class="nav-link flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">assignment_return</span>
                                <span>المرتجعات</span>
                            </a>
                        </li>
                        <li>
                            <a href="#payments" class="nav-link flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">payments</span>
                                <span>الدفعات</span>
                            </a>
                        </li>
                        <li>
                            <a href="#statements" class="nav-link flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">account_balance_wallet</span>
                                <span>كشوف الحسابات</span>
                            </a>
                        </li>
                        <li id="users-menu-item" class="hidden">
                            <a href="#users" class="nav-link flex items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">manage_accounts</span>
                                <span>إدارة المستخدمين</span>
                            </a>
                        </li>
                        <li>
                            <button id="logout-button" class="flex w-full items-center p-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded">
                                <span class="material-icons-outlined text-xl ml-2">logout</span>
                                <span>تسجيل الخروج</span>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 dark:bg-gray-900">
                <!-- Top Navigation -->
                <header class="bg-white dark:bg-gray-800 shadow">
                    <div class="px-4 py-3 flex justify-between items-center">
                        <button id="sidebar-toggle" class="text-gray-500 focus:outline-none lg:hidden">
                            <span class="material-icons">menu</span>
                        </button>
                        <div class="flex items-center">
                            <button id="dark-mode-toggle" class="rounded-full p-1 text-gray-500 focus:outline-none">
                                <span class="material-icons" id="theme-icon">dark_mode</span>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Page Content -->
                <div id="content-container" class="p-4 md:p-6">
                    <!-- Content pages will be loaded here based on navigation -->
                </div>
            </div>
        </div>
    </div>

    <!-- Include Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCpTjPsfaWTuNjpUupteqALjmb0qLUAzg8",
            authDomain: "delta-hcp.firebaseapp.com",
            projectId: "delta-hcp",
            storageBucket: "delta-hcp.firebasestorage.app",
            messagingSenderId: "956838180358",
            appId: "1:956838180358:web:af6abd7a430a8e17c83587",
            measurementId: "G-NJT5FCNJK3"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Authentication State
        let currentUser = null;
        let userRole = "user"; // Default role
        let inactivityTimer;

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const registerPage = document.getElementById('register-page');
        const authContainer = document.getElementById('auth-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        const contentContainer = document.getElementById('content-container');
        const usersMenuItem = document.getElementById('users-menu-item');
        const userNameElement = document.getElementById('user-name');
        const userRoleElement = document.getElementById('user-role');

        // Form Elements
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginButton = document.getElementById('login-button');
        const registerButton = document.getElementById('register-button');
        const logoutButton = document.getElementById('logout-button');
        const registerRedirect = document.getElementById('register-redirect');
        const loginRedirect = document.getElementById('login-redirect');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const themeIcon = document.getElementById('theme-icon');

        // Apply Dark Mode if user prefers
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
            themeIcon.textContent = 'light_mode';
        }
        
        // Dark Mode Toggle
        darkModeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                themeIcon.textContent = 'light_mode';
            } else {
                themeIcon.textContent = 'dark_mode';
            }
        });

        // Listen for dark mode changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
                themeIcon.textContent = 'light_mode';
            } else {
                document.documentElement.classList.remove('dark');
                themeIcon.textContent = 'dark_mode';
            }
        });

        // Sidebar Toggle for Mobile
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });

        // Page Navigation
        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('#content-container > div');
            pages.forEach(page => page.classList.add('hidden'));

            // Show the selected page
            const selectedPage = document.getElementById(pageId + '-page');
            if (selectedPage) {
                selectedPage.classList.remove('hidden');
            } else {
                loadPage(pageId);
            }

            // Update active navigation link
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active', 'bg-gray-700', 'text-white'));
            const activeLink = document.querySelector(`.nav-link[href="#${pageId}"]`);
            if (activeLink) {
                activeLink.classList.add('active', 'bg-gray-700', 'text-white');
            }
        }

        // Create page content dynamically based on navigation
        function loadPage(pageId) {
            let pageContent = '';
            switch (pageId) {
                case 'dashboard':
                    pageContent = createDashboardPage();
                    break;
                case 'products':
                    pageContent = createProductsPage();
                    break;
                case 'customers':
                    pageContent = createCustomersPage();
                    break;
                case 'invoices':
                    pageContent = createInvoicesPage();
                    break;
                case 'returns':
                    pageContent = createReturnsPage();
                    break;
                case 'payments':
                    pageContent = createPaymentsPage();
                    break;
                case 'statements':
                    pageContent = createStatementsPage();
                    break;
                case 'users':
                    pageContent = createUsersPage();
                    break;
                default:
                    pageContent = '<div class="text-center p-12"><p>الصفحة غير متوفرة</p></div>';
            }

            const newPage = document.createElement('div');
            newPage.id = pageId + '-page';
            newPage.innerHTML = pageContent;
            contentContainer.appendChild(newPage);
        }

        // Page Content Creators
        function createDashboardPage() {
            return `
                <div class="mb-6">
                    <h1 class="text-2xl font-bold text-gray-800 dark:text-white">لوحة التحكم</h1>
                    <p class="text-gray-600 dark:text-gray-300">مرحباً بك في نظام إدارة شركة الدهانات</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">إجمالي المبيعات</p>
                                <h3 class="text-2xl font-bold text-gray-700 dark:text-white">0</h3>
                            </div>
                            <div class="rounded-full bg-blue-100 p-3 text-blue-500">
                                <span class="material-icons">trending_up</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">عدد العملاء</p>
                                <h3 class="text-2xl font-bold text-gray-700 dark:text-white">0</h3>
                            </div>
                            <div class="rounded-full bg-green-100 p-3 text-green-500">
                                <span class="material-icons">people</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">عدد المنتجات</p>
                                <h3 class="text-2xl font-bold text-gray-700 dark:text-white">0</h3>
                            </div>
                            <div class="rounded-full bg-yellow-100 p-3 text-yellow-500">
                                <span class="material-icons">inventory_2</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">المدفوعات اليوم</p>
                                <h3 class="text-2xl font-bold text-gray-700 dark:text-white">0</h3>
                            </div>
                            <div class="rounded-full bg-purple-100 p-3 text-purple-500">
                                <span class="material-icons">payments</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-gray-700 dark:text-white mb-4">أحدث المبيعات</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">رقم الفاتورة</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">العميل</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">المبلغ</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="4">
                                            لا توجد بيانات
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-gray-700 dark:text-white mb-4">أحدث المدفوعات</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">رقم المعاملة</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">العميل</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">المبلغ</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">طريقة الدفع</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="4">
                                            لا توجد بيانات
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function createProductsPage() {
            return `
                <div class="mb-6 flex flex-wrap items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">إدارة المنتجات</h1>
                        <p class="text-gray-600 dark:text-gray-300">إضافة، تعديل، وإدارة المنتجات</p>
                    </div>
                    <button id="add-product-button" class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                        <span class="material-icons-outlined ml-1">add</span>
                        إضافة منتج
                    </button>
                </div>
                
                <!-- Search and Export Bar -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6">
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                                    <span class="material-icons-outlined">search</span>
                                </span>
                                <input type="search" id="product-search" class="block w-full p-2 pr-10 text-base border border-gray-300 rounded-md focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="بحث عن منتج...">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="product-category-filter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white rounded-md focus:ring-primary focus:border-primary py-2 px-4 text-base">
                                <option value="">كل التصنيفات</option>
                                <option value="construction">إنشائي</option>
                                <option value="exterior">واجهات خارجية</option>
                                <option value="decorative">ديكوري</option>
                            </select>
                            <button id="export-products-pdf" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">picture_as_pdf</span>
                                PDF
                            </button>
                            <button id="export-products-excel" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">table_view</span>
                                Excel
                            </button>
                            <button id="print-products" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">print</span>
                                طباعة
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Products Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">اسم المنتج</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التصنيف</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">اللون/الباتش</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">السعر</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="products-table-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="5">
                                        لا توجد منتجات
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Product Modal -->
                <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4 overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white" id="product-modal-title">إضافة منتج جديد</h3>
                            <button id="close-product-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <form id="product-form" class="p-4">
                            <input type="hidden" id="product-id">
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="product-category">
                                    تصنيف المنتج
                                </label>
                                <select id="product-category" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                    <option value="">اختر التصنيف</option>
                                    <option value="construction">إنشائي</option>
                                    <option value="exterior">واجهات خارجية</option>
                                    <option value="decorative">ديكوري</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="product-name">
                                    اسم المنتج
                                </label>
                                <input type="text" id="product-name" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="product-batch">
                                    اللون/الباتش
                                </label>
                                <input type="text" id="product-batch" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="product-price">
                                    السعر
                                </label>
                                <input type="number" min="0" step="0.01" id="product-price" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="flex justify-end space-x-3 space-x-reverse">
                                <button type="button" id="cancel-product" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 focus:outline-none">
                                    إلغاء
                                </button>
                                <button type="submit" id="save-product" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                                    <span id="save-product-text">حفظ</span>
                                    <span class="loading hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function createCustomersPage() {
            return `
                <div class="mb-6 flex flex-wrap items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">إدارة العملاء</h1>
                        <p class="text-gray-600 dark:text-gray-300">إضافة، تعديل، وإدارة العملاء</p>
                    </div>
                    <button id="add-customer-button" class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                        <span class="material-icons-outlined ml-1">add</span>
                        إضافة عميل
                    </button>
                </div>
                
                <!-- Search and Export Bar -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6">
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                                    <span class="material-icons-outlined">search</span>
                                </span>
                                <input type="search" id="customer-search" class="block w-full p-2 pr-10 text-base border border-gray-300 rounded-md focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="بحث عن عميل...">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="customer-category-filter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white rounded-md focus:ring-primary focus:border-primary py-2 px-4 text-base">
                                <option value="">كل التصنيفات</option>
                                <option value="institutions">هيئات/مشاريع</option>
                                <option value="shops">محلات</option>
                                <option value="individuals">أهالي</option>
                            </select>
                            <button id="export-customers-pdf" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">picture_as_pdf</span>
                                PDF
                            </button>
                            <button id="export-customers-excel" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">table_view</span>
                                Excel
                            </button>
                            <button id="print-customers" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">print</span>
                                طباعة
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Customers Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">اسم العميل</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">رقم الهاتف</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">العنوان</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التصنيف</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">نسبة الخصم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="customers-table-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="6">
                                        لا يوجد عملاء
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Customer Modal -->
                <div id="customer-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4 overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white" id="customer-modal-title">إضافة عميل جديد</h3>
                            <button id="close-customer-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <form id="customer-form" class="p-4">
                            <input type="hidden" id="customer-id">
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="customer-name">
                                    اسم العميل
                                </label>
                                <input type="text" id="customer-name" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="customer-phone">
                                    رقم الهاتف
                                </label>
                                <input type="tel" id="customer-phone" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="customer-address">
                                    العنوان
                                </label>
                                <input type="text" id="customer-address" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="customer-category">
                                    تصنيف العميل
                                </label>
                                <select id="customer-category" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                    <option value="">اختر التصنيف</option>
                                    <option value="institutions">هيئات/مشاريع</option>
                                    <option value="shops">محلات</option>
                                    <option value="individuals">أهالي</option>
                                </select>
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="customer-discount">
                                    نسبة الخصم (%)
                                </label>
                                <input type="number" min="0" max="100" id="customer-discount" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" value="0" required>
                            </div>
                            <div class="flex justify-end space-x-3 space-x-reverse">
                                <button type="button" id="cancel-customer" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 focus:outline-none">
                                    إلغاء
                                </button>
                                <button type="submit" id="save-customer" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                                    <span id="save-customer-text">حفظ</span>
                                    <span class="loading hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function createInvoicesPage() {
            return `
                <div class="mb-6 flex flex-wrap items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">إدارة الفواتير</h1>
                        <p class="text-gray-600 dark:text-gray-300">إنشاء وعرض الفواتير</p>
                    </div>
                    <button id="add-invoice-button" class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                        <span class="material-icons-outlined ml-1">add</span>
                        إنشاء فاتورة جديدة
                    </button>
                </div>
                
                <!-- Search and Export Bar -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6">
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                                    <span class="material-icons-outlined">search</span>
                                </span>
                                <input type="search" id="invoice-search" class="block w-full p-2 pr-10 text-base border border-gray-300 rounded-md focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="بحث عن فاتورة...">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="customer-invoice-filter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white rounded-md focus:ring-primary focus:border-primary py-2 px-4 text-base">
                                <option value="">كل العملاء</option>
                                <!-- سيتم ملئها بالعملاء ديناميكياً -->
                            </select>
                            <button id="export-invoices-pdf" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">picture_as_pdf</span>
                                PDF
                            </button>
                            <button id="export-invoices-excel" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">table_view</span>
                                Excel
                            </button>
                            <button id="print-invoices" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">print</span>
                                طباعة
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Invoices Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">رقم الفاتورة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">العميل</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجمالي المبلغ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">طريقة الدفع</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحالة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="invoices-table-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="7">
                                        لا توجد فواتير
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Invoice Modal -->
                <div id="invoice-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-4xl mx-4 overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white" id="invoice-modal-title">إنشاء فاتورة جديدة</h3>
                            <button id="close-invoice-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <form id="invoice-form" class="p-4">
                            <input type="hidden" id="invoice-id">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="invoice-number">
                                        رقم الفاتورة
                                    </label>
                                    <input type="text" id="invoice-number" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" readonly>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="invoice-date">
                                        التاريخ
                                    </label>
                                    <input type="date" id="invoice-date" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="invoice-customer">
                                    العميل
                                </label>
                                <select id="invoice-customer" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                    <option value="">اختر العميل</option>
                                    <!-- سيتم ملئها بالعملاء ديناميكياً -->
                                </select>
                            </div>
                            
                            <!-- Products Section -->
                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium">المنتجات</label>
                                    <button type="button" id="add-invoice-item" class="inline-flex items-center px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none text-sm">
                                        <span class="material-icons-outlined text-sm ml-1">add</span>
                                        إضافة منتج
                                    </button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">المنتج</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الباتش/اللون</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الكمية</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">السعر</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجمالي</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">حذف</th>
                                            </tr>
                                        </thead>
                                        <tbody id="invoice-items-container" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Items will be added here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Payment Section -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="invoice-payment-method">
                                        طريقة الدفع
                                    </label>
                                    <select id="invoice-payment-method" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                        <option value="">اختر طريقة الدفع</option>
                                        <option value="cash">نقدي</option>
                                        <option value="bank">تحويل بنكي</option>
                                        <option value="check">شيك</option>
                                        <option value="vodafone">فودافون كاش</option>
                                    </select>
                                </div>
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input id="invoice-has-deposit" type="checkbox" class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary">
                                        <label for="invoice-has-deposit" class="mr-2 block text-sm text-gray-700 dark:text-gray-300">عربون</label>
                                    </div>
                                    <div id="deposit-container" class="grid grid-cols-2 gap-2 hidden">
                                        <div>
                                            <input type="number" min="0" id="invoice-deposit-amount" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" placeholder="المبلغ">
                                        </div>
                                        <div>
                                            <select id="invoice-deposit-method" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base">
                                                <option value="cash">نقدي</option>
                                                <option value="bank">تحويل بنكي</option>
                                                <option value="check">شيك</option>
                                                <option value="vodafone">فودافون كاش</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="invoice-notes">
                                    ملاحظات
                                </label>
                                <textarea id="invoice-notes" rows="3" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base"></textarea>
                            </div>
                            
                            <!-- Totals Section -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2">
                                        المبلغ قبل الخصم
                                    </label>
                                    <input type="text" id="invoice-subtotal" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base bg-gray-100 dark:bg-gray-600" readonly>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2">
                                        الخصم (%)
                                    </label>
                                    <input type="number" min="0" max="100" id="invoice-discount" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" value="0">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2">
                                        المبلغ النهائي
                                    </label>
                                    <input type="text" id="invoice-total" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base bg-gray-100 dark:bg-gray-600" readonly>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3 space-x-reverse">
                                <button type="button" id="cancel-invoice" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 focus:outline-none">
                                    إلغاء
                                </button>
                                <button type="submit" id="save-invoice" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                                    <span id="save-invoice-text">حفظ الفاتورة</span>
                                    <span class="loading hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function createReturnsPage() {
            return `
                <div class="mb-6 flex flex-wrap items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">إدارة المرتجعات</h1>
                        <p class="text-gray-600 dark:text-gray-300">إنشاء وعرض فواتير المرتجعات</p>
                    </div>
                    <button id="add-return-button" class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                        <span class="material-icons-outlined ml-1">add</span>
                        إنشاء فاتورة مرتجع
                    </button>
                </div>
                
                <!-- Search and Export Bar -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6">
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                                    <span class="material-icons-outlined">search</span>
                                </span>
                                <input type="search" id="return-search" class="block w-full p-2 pr-10 text-base border border-gray-300 rounded-md focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="بحث عن مرتجع...">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="customer-return-filter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white rounded-md focus:ring-primary focus:border-primary py-2 px-4 text-base">
                                <option value="">كل العملاء</option>
                                <!-- سيتم ملئها بالعملاء ديناميكياً -->
                            </select>
                            <button id="export-returns-pdf" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">picture_as_pdf</span>
                                PDF
                            </button>
                            <button id="export-returns-excel" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">table_view</span>
                                Excel
                            </button>
                            <button id="print-returns" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">print</span>
                                طباعة
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Returns Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">رقم المرتجع</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">العميل</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجمالي المبلغ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ملاحظات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="returns-table-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="6">
                                        لا توجد مرتجعات
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Return Modal -->
                <div id="return-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-4xl mx-4 overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white" id="return-modal-title">إنشاء فاتورة مرتجع</h3>
                            <button id="close-return-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <form id="return-form" class="p-4">
                            <input type="hidden" id="return-id">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="return-number">
                                        رقم المرتجع
                                    </label>
                                    <input type="text" id="return-number" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" readonly>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="return-date">
                                        التاريخ
                                    </label>
                                    <input type="date" id="return-date" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="return-customer">
                                    العميل
                                </label>
                                <select id="return-customer" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                    <option value="">اختر العميل</option>
                                    <!-- سيتم ملئها بالعملاء ديناميكياً -->
                                </select>
                            </div>
                            
                            <!-- Products Section -->
                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium">المنتجات المرتجعة</label>
                                    <button type="button" id="add-return-item" class="inline-flex items-center px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none text-sm">
                                        <span class="material-icons-outlined text-sm ml-1">add</span>
                                        إضافة منتج
                                    </button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">المنتج</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الباتش/اللون</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الكمية</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">السعر</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجمالي</th>
                                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">حذف</th>
                                            </tr>
                                        </thead>
                                        <tbody id="return-items-container" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Items will be added here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="return-notes">
                                    ملاحظات
                                </label>
                                <textarea id="return-notes" rows="3" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base"></textarea>
                            </div>
                            
                            <!-- Totals Section -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2">
                                        المبلغ قبل الخصم
                                    </label>
                                    <input type="text" id="return-subtotal" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base bg-gray-100 dark:bg-gray-600" readonly>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2">
                                        الخصم (%)
                                    </label>
                                    <input type="number" min="0" max="100" id="return-discount" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" value="0">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2">
                                        المبلغ النهائي
                                    </label>
                                    <input type="text" id="return-total" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base bg-gray-100 dark:bg-gray-600" readonly>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3 space-x-reverse">
                                <button type="button" id="cancel-return" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 focus:outline-none">
                                    إلغاء
                                </button>
                                <button type="submit" id="save-return" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                                    <span id="save-return-text">حفظ المرتجع</span>
                                    <span class="loading hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function createPaymentsPage() {
            return `
                <div class="mb-6 flex flex-wrap items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">إدارة المدفوعات</h1>
                        <p class="text-gray-600 dark:text-gray-300">تسجيل وعرض مدفوعات العملاء</p>
                    </div>
                    <button id="add-payment-button" class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                        <span class="material-icons-outlined ml-1">add</span>
                        تسجيل دفعة جديدة
                    </button>
                </div>
                
                <!-- Search and Export Bar -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6">
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                                    <span class="material-icons-outlined">search</span>
                                </span>
                                <input type="search" id="payment-search" class="block w-full p-2 pr-10 text-base border border-gray-300 rounded-md focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="بحث عن دفعة...">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="customer-payment-filter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white rounded-md focus:ring-primary focus:border-primary py-2 px-4 text-base">
                                <option value="">كل العملاء</option>
                                <!-- سيتم ملئها بالعملاء ديناميكياً -->
                            </select>
                            <button id="export-payments-pdf" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">picture_as_pdf</span>
                                PDF
                            </button>
                            <button id="export-payments-excel" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">table_view</span>
                                Excel
                            </button>
                            <button id="print-payments" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">print</span>
                                طباعة
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Payments Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">رقم الدفعة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">العميل</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">المبلغ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">طريقة الدفع</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ملاحظات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="payments-table-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="7">
                                        لا توجد مدفوعات
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Payment Modal -->
                <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4 overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white" id="payment-modal-title">تسجيل دفعة جديدة</h3>
                            <button id="close-payment-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <form id="payment-form" class="p-4">
                            <input type="hidden" id="payment-id">
                            <div class="grid grid-cols-1 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="payment-number">
                                        رقم الدفعة
                                    </label>
                                    <input type="text" id="payment-number" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" readonly>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="payment-date">
                                        التاريخ
                                    </label>
                                    <input type="date" id="payment-date" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="payment-customer">
                                    العميل
                                </label>
                                <select id="payment-customer" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                    <option value="">اختر العميل</option>
                                    <!-- سيتم ملئها بالعملاء ديناميكياً -->
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="payment-invoice">
                                    الفاتورة (اختياري)
                                </label>
                                <select id="payment-invoice" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base">
                                    <option value="">بدون ربط بفاتورة</option>
                                    <!-- سيتم ملئها بالفواتير ديناميكياً -->
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="payment-amount">
                                    المبلغ
                                </label>
                                <input type="number" min="0" step="0.01" id="payment-amount" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="payment-method">
                                    طريقة الدفع
                                </label>
                                <select id="payment-method" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                    <option value="">اختر طريقة الدفع</option>
                                    <option value="cash">نقدي</option>
                                    <option value="bank">تحويل بنكي</option>
                                    <option value="check">شيك</option>
                                    <option value="vodafone">فودافون كاش</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="payment-notes">
                                    ملاحظات
                                </label>
                                <textarea id="payment-notes" rows="3" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base"></textarea>
                            </div>
                            <div class="flex justify-end space-x-3 space-x-reverse">
                                <button type="button" id="cancel-payment" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 focus:outline-none">
                                    إلغاء
                                </button>
                                <button type="submit" id="save-payment" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                                    <span id="save-payment-text">حفظ الدفعة</span>
                                    <span class="loading hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function createStatementsPage() {
            return `
                <div class="mb-6 flex flex-wrap items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">كشوف حسابات العملاء</h1>
                        <p class="text-gray-600 dark:text-gray-300">عرض كشوف حسابات العملاء</p>
                    </div>
                </div>
                
                <!-- Search and Export Bar -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6">
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                                    <span class="material-icons-outlined">search</span>
                                </span>
                                <input type="search" id="statement-customer-search" class="block w-full p-2 pr-10 text-base border border-gray-300 rounded-md focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="بحث عن عميل...">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="statement-customer-filter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white rounded-md focus:ring-primary focus:border-primary py-2 px-4 text-base">
                                <option value="">كل العملاء</option>
                                <!-- سيتم ملئها بالعملاء ديناميكياً -->
                            </select>
                            <button id="export-statement-pdf" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">picture_as_pdf</span>
                                PDF
                            </button>
                            <button id="export-statement-excel" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">table_view</span>
                                Excel
                            </button>
                            <button id="print-statement" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">print</span>
                                طباعة
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Customers Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden mb-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">اسم العميل</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">رقم الهاتف</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجمالي المبيعات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجمالي المدفوعات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجمالي المرتجعات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الرصيد</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">عرض</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="statements-table-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="7">
                                        لا توجد بيانات
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Statement Details Section -->
                <div id="statement-details" class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden mb-6 hidden">
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-700 dark:text-white" id="statement-customer-name">كشف حساب: </h3>
                            <button id="close-statement-details" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-md">
                                <p class="text-sm text-gray-500 dark:text-gray-400">إجمالي المبيعات</p>
                                <p class="text-xl font-semibold text-gray-700 dark:text-white" id="statement-total-sales">0</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-md">
                                <p class="text-sm text-gray-500 dark:text-gray-400">إجمالي المدفوعات</p>
                                <p class="text-xl font-semibold text-gray-700 dark:text-white" id="statement-total-payments">0</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-md">
                                <p class="text-sm text-gray-500 dark:text-gray-400">إجمالي المرتجعات</p>
                                <p class="text-xl font-semibold text-gray-700 dark:text-white" id="statement-total-returns">0</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-md">
                                <p class="text-sm text-gray-500 dark:text-gray-400">الرصيد الحالي</p>
                                <p class="text-xl font-semibold text-gray-700 dark:text-white" id="statement-balance">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statement Transactions -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">نوع العملية</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الرقم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">البيان</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">مدين</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">دائن</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الرصيد</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="statement-transactions-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="7">
                                        لا توجد معاملات
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function createUsersPage() {
            return `
                <div class="mb-6 flex flex-wrap items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">إدارة المستخدمين</h1>
                        <p class="text-gray-600 dark:text-gray-300">إضافة وإدارة مستخدمي النظام</p>
                    </div>
                    <button id="add-user-button" class="mt-4 md:mt-0 inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                        <span class="material-icons-outlined ml-1">add</span>
                        إضافة مستخدم
                    </button>
                </div>
                
                <!-- Search and Export Bar -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-6">
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                                    <span class="material-icons-outlined">search</span>
                                </span>
                                <input type="search" id="user-search" class="block w-full p-2 pr-10 text-base border border-gray-300 rounded-md focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="بحث عن مستخدم...">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="user-role-filter" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white rounded-md focus:ring-primary focus:border-primary py-2 px-4 text-base">
                                <option value="">كل الأدوار</option>
                                <option value="admin">مدير</option>
                                <option value="supervisor">مشرف</option>
                                <option value="user">مستخدم</option>
                            </select>
                            <button id="export-users-pdf" class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">picture_as_pdf</span>
                                PDF
                            </button>
                            <button id="export-users-excel" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">table_view</span>
                                Excel
                            </button>
                            <button id="print-users" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">
                                <span class="material-icons-outlined ml-1">print</span>
                                طباعة
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الاسم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">البريد الإلكتروني</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الدور</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">تاريخ الإنشاء</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="users-table-body">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" colspan="5">
                                        لا يوجد مستخدمين
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- User Modal -->
                <div id="user-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md mx-4 overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white" id="user-modal-title">إضافة مستخدم جديد</h3>
                            <button id="close-user-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <form id="user-form" class="p-4">
                            <input type="hidden" id="user-id">
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="user-name">
                                    الاسم
                                </label>
                                <input type="text" id="user-name" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="user-email">
                                    البريد الإلكتروني
                                </label>
                                <input type="email" id="user-email" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="user-password">
                                    كلمة المرور
                                </label>
                                <input type="password" id="user-password" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required minlength="6">
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" for="user-role">
                                    الدور
                                </label>
                                <select id="user-role" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary text-base" required>
                                    <option value="">اختر الدور</option>
                                    <option value="admin">مدير</option>
                                    <option value="supervisor">مشرف</option>
                                    <option value="user">مستخدم</option>
                                </select>
                            </div>
                            <div class="flex justify-end space-x-3 space-x-reverse">
                                <button type="button" id="cancel-user" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 focus:outline-none">
                                    إلغاء
                                </button>
                                <button type="submit" id="save-user" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 focus:outline-none">
                                    <span id="save-user-text">حفظ</span>
                                    <span class="loading hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // UI Event Listeners
        registerRedirect.addEventListener('click', () => {
            loginPage.classList.add('hidden');
            registerPage.classList.remove('hidden');
        });

        loginRedirect.addEventListener('click', () => {
            registerPage.classList.add('hidden');
            loginPage.classList.remove('hidden');
        });

        // Handle login form submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password');
            const rememberMe = document.getElementById('remember-me').checked;
            const loginButtonText = loginButton.querySelector('span:not(.loading)');
            const loginButtonLoader = loginButton.querySelector('.loading');
            
            // Show loading state
            loginButtonText.classList.add('hidden');
            loginButtonLoader.classList.remove('hidden');
            loginButton.disabled = true;
            
            try {
                // Attempt to log in
                const persistence = rememberMe ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION;
                await firebase.auth().setPersistence(persistence);
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password.value);
                
                // Get user role from Firestore
                const userDoc = await db.collection('users').doc(userCredential.user.uid).get();
                if (userDoc.exists) {
                    userRole = userDoc.data().role || 'user';
                }
                
                // Success! User will be redirected by onAuthStateChanged
                Swal.fire({
                    icon: 'success',
                    title: 'تم تسجيل الدخول بنجاح',
                    showConfirmButton: false,
                    timer: 1500
                });
            } catch (error) {
                // Handle errors
                console.error("Login error:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ في تسجيل الدخول',
                    text: getAuthErrorMessage(error),
                });
                
                // Reset form state
                loginButtonText.classList.remove('hidden');
                loginButtonLoader.classList.add('hidden');
                loginButton.disabled = false;
            }
        });

        // Handle registration form submission
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const registerButtonText = registerButton.querySelector('span:not(.loading)');
            const registerButtonLoader = registerButton.querySelector('.loading');
            
            // Show loading state
            registerButtonText.classList.add('hidden');
            registerButtonLoader.classList.remove('hidden');
            registerButton.disabled = true;
            
            try {
                // Create user
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                
                // Add user details to Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    role: 'user', // Default role for new users
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Success!
                Swal.fire({
                    icon: 'success',
                    title: 'تم إنشاء الحساب بنجاح',
                    text: 'سيتم تسجيل دخولك تلقائياً',
                    showConfirmButton: false,
                    timer: 1500
                });
                
                // User will be redirected by onAuthStateChanged
            } catch (error) {
                // Handle errors
                console.error("Registration error:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ في إنشاء الحساب',
                    text: getAuthErrorMessage(error),
                });
                
                // Reset form state
                registerButtonText.classList.remove('hidden');
                registerButtonLoader.classList.add('hidden');
                registerButton.disabled = false;
            }
        });

        // Handle logout
        logoutButton.addEventListener('click', async () => {
            try {
                await firebase.auth().signOut();
                Swal.fire({
                    icon: 'success',
                    title: 'تم تسجيل الخروج بنجاح',
                    showConfirmButton: false,
                    timer: 1500
                });
            } catch (error) {
                console.error("Logout error:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ في تسجيل الخروج',
                    text: error.message,
                });
            }
        });

        // Handle navigation
        document.addEventListener('click', (e) => {
            const link = e.target.closest('.nav-link');
            if (link) {
                e.preventDefault();
                const pageId = link.getAttribute('href').substring(1);
                showPage(pageId);
            }
        });

        // Translate authentication error messages
        function getAuthErrorMessage(error) {
            switch (error.code) {
                case 'auth/invalid-email':
                    return 'البريد الإلكتروني غير صحيح';
                case 'auth/user-disabled':
                    return 'تم تعطيل هذا الحساب';
                case 'auth/user-not-found':
                    return 'البريد الإلكتروني غير مسجل';
                case 'auth/wrong-password':
                    return 'كلمة المرور غير صحيحة';
                case 'auth/email-already-in-use':
                    return 'البريد الإلكتروني مستخدم بالفعل';
                case 'auth/weak-password':
                    return 'كلمة المرور ضعيفة جداً، يجب أن تكون 6 أحرف على الأقل';
                default:
                    return error.message;
            }
        }

        // Monitor authentication state
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                // User is signed in
                currentUser = user;
                
                // Get user role from Firestore
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        userRole = userDoc.data().role || 'user';
                        const userName = userDoc.data().name || 'المستخدم';
                        userNameElement.textContent = `مرحباً، ${userName}`;
                        userRoleElement.textContent = `صلاحيات: ${translateRole(userRole)}`;
                        
                        // Show admin-only menu items
                        if (userRole === 'admin') {
                            usersMenuItem.classList.remove('hidden');
                        } else {
                            usersMenuItem.classList.add('hidden');
                        }
                    }
                } catch (error) {
                    console.error("Error getting user role:", error);
                }
                
                // Reset any loading states
                const loginButtonText = loginButton.querySelector('span:not(.loading)');
                const loginButtonLoader = loginButton.querySelector('.loading');
                loginButtonText.classList.remove('hidden');
                loginButtonLoader.classList.add('hidden');
                loginButton.disabled = false;
                
                const registerButtonText = registerButton.querySelector('span:not(.loading)');
                const registerButtonLoader = registerButton.querySelector('.loading');
                registerButtonText.classList.remove('hidden');
                registerButtonLoader.classList.add('hidden');
                registerButton.disabled = false;
                
                // Show dashboard
                authContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');
                
                // Load default page
                showPage('dashboard');
                
                // Setup inactivity timeout
                setupInactivityTimeout();
            } else {
                // User is signed out
                currentUser = null;
                userRole = 'user';
                
                // Show login page
                dashboardContainer.classList.add('hidden');
                authContainer.classList.remove('hidden');
                loginPage.classList.remove('hidden');
                registerPage.classList.add('hidden');
                
                // Clear inactivity timeout
                clearTimeout(inactivityTimer);
            }
        });

        // Translate role names
        function translateRole(role) {
            switch (role) {
                case 'admin':
                    return 'مدير';
                case 'supervisor':
                    return 'مشرف';
                case 'user':
                    return 'مستخدم';
                default:
                    return role;
            }
        }

        // Setup inactivity timeout (5 minutes)
        function setupInactivityTimeout() {
            const resetTimer = () => {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    if (currentUser) {
                        Swal.fire({
                            title: 'تنبيه',
                            text: 'سيتم تسجيل خروجك تلقائياً بسبب عدم النشاط',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'البقاء',
                            cancelButtonText: 'تسجيل الخروج',
                            reverseButtons: true
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // User wants to stay, reset timer
                                setupInactivityTimeout();
                            } else {
                                // User clicked logout or closed the dialog
                                firebase.auth().signOut();
                            }
                        });
                    }
                }, 5 * 60 * 1000); // 5 minutes
            };
            
            // Reset timer on user activity
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(
                event => document.addEventListener(event, resetTimer, { passive: true })
            );
            
            // Initial timer
            resetTimer();
        }

        // Initialize event handlers for various sections
        function initializeDynamicEventHandlers() {
            // These will be set up when specific pages are loaded
            document.addEventListener('click', (e) => {
                // Product Modal Events
                if (e.target.closest('#add-product-button')) {
                    document.getElementById('product-modal').classList.remove('hidden');
                    document.getElementById('product-form').reset();
                    document.getElementById('product-modal-title').textContent = 'إضافة منتج جديد';
                }
                
                if (e.target.closest('#close-product-modal') || e.target.closest('#cancel-product')) {
                    document.getElementById('product-modal').classList.add('hidden');
                }
                
                // Customer Modal Events
                if (e.target.closest('#add-customer-button')) {
                    document.getElementById('customer-modal').classList.remove('hidden');
                    document.getElementById('customer-form').reset();
                    document.getElementById('customer-modal-title').textContent = 'إضافة عميل جديد';
                }
                
                if (e.target.closest('#close-customer-modal') || e.target.closest('#cancel-customer')) {
                    document.getElementById('customer-modal').classList.add('hidden');
                }
                
                // Invoice Modal Events
                if (e.target.closest('#add-invoice-button')) {
                    document.getElementById('invoice-modal').classList.remove('hidden');
                    document.getElementById('invoice-form').reset();
                    document.getElementById('invoice-modal-title').textContent = 'إنشاء فاتورة جديدة';
                    // Set current date
                    document.getElementById('invoice-date').valueAsDate = new Date();
                    // Generate a new invoice number (would be better from server/DB)
                    document.getElementById('invoice-number').value = 'INV-' + Date.now();
                }
                
                if (e.target.closest('#close-invoice-modal') || e.target.closest('#cancel-invoice')) {
                    document.getElementById('invoice-modal').classList.add('hidden');
                }
                
                // Return Modal Events
                if (e.target.closest('#add-return-button')) {
                    document.getElementById('return-modal').classList.remove('hidden');
                    document.getElementById('return-form').reset();
                    document.getElementById('return-modal-title').textContent = 'إنشاء فاتورة مرتجع';
                    // Set current date
                    document.getElementById('return-date').valueAsDate = new Date();
                    // Generate a new return number
                    document.getElementById('return-number').value = 'RET-' + Date.now();
                }
                
                if (e.target.closest('#close-return-modal') || e.target.closest('#cancel-return')) {
                    document.getElementById('return-modal').classList.add('hidden');
                }
                
                // Payment Modal Events
                if (e.target.closest('#add-payment-button')) {
                    document.getElementById('payment-modal').classList.remove('hidden');
                    document.getElementById('payment-form').reset();
                    document.getElementById('payment-modal-title').textContent = 'تسجيل دفعة جديدة';
                    // Set current date
                    document.getElementById('payment-date').valueAsDate = new Date();
                    // Generate a new payment number
                    document.getElementById('payment-number').value = 'PAY-' + Date.now();
                }
                
                if (e.target.closest('#close-payment-modal') || e.target.closest('#cancel-payment')) {
                    document.getElementById('payment-modal').classList.add('hidden');
                }
                
                // User Modal Events
                if (e.target.closest('#add-user-button')) {
                    document.getElementById('user-modal').classList.remove('hidden');
                    document.getElementById('user-form').reset();
                    document.getElementById('user-modal-title').textContent = 'إضافة مستخدم جديد';
                }
                
                if (e.target.closest('#close-user-modal') || e.target.closest('#cancel-user')) {
                    document.getElementById('user-modal').classList.add('hidden');
                }
                
                // Statement Details Close
                if (e.target.closest('#close-statement-details')) {
                    document.getElementById('statement-details').classList.add('hidden');
                }
            });
            
            // Deposit fields toggle in invoice form
            const depositCheckbox = document.getElementById('invoice-has-deposit');
            if (depositCheckbox) {
                depositCheckbox.addEventListener('change', function() {
                    const depositContainer = document.getElementById('deposit-container');
                    if (this.checked) {
                        depositContainer.classList.remove('hidden');
                    } else {
                        depositContainer.classList.add('hidden');
                    }
                });
            }
        }

        // Call this after DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeDynamicEventHandlers();
        });
    </script>
</body>
</html>

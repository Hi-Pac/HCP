<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام مبيعات الدهانات | Delta HCP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #5D5CDE;
            --secondary-color: #4CAF50;
            --danger-color: #F44336;
            --warning-color: #FFC107;
            --info-color: #2196F3;
            --light-bg: #FFFFFF;
            --dark-bg: #181818;
            --light-text: #333333;
            --dark-text: #F5F5F5;
        }

        * {
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--light-text);
        }

        .dark body {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .primary-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .primary-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .secondary-btn {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .secondary-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .dark .card {
            background-color: #222;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .dark .input-field {
            background-color: #333;
            border-color: #555;
            color: #f5f5f5;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.2);
        }

        .loading-spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary-color);
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .dark .loading-spinner {
            border-color: rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary-color);
        }

        /* بداية تصميم الداشبورد */
        .sidebar {
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            width: 250px;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .sidebar-collapsed {
            transform: translateX(240px);
        }

        .main-content {
            margin-right: 250px;
            transition: all 0.3s ease;
        }

        .main-content-expanded {
            margin-right: 60px;
        }

        .nav-item {
            margin-bottom: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .dark .nav-item:hover, .dark .nav-item.active {
            background-color: rgba(93, 92, 222, 0.2);
        }

        .nav-item i {
            margin-left: 0.75rem;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(100%);
            }
            
            .sidebar-visible {
                transform: translateX(0);
            }
            
            .main-content {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login / Register Section -->
        <section id="auth-section" class="min-h-screen flex items-center justify-center p-4">
            <div class="card max-w-md w-full">
                <div class="flex border-b">
                    <button id="login-tab" class="flex-1 py-3 px-4 font-medium text-center border-b-2 border-primary-color text-primary-color">تسجيل الدخول</button>
                    <button id="register-tab" class="flex-1 py-3 px-4 font-medium text-center text-gray-500">تسجيل مستخدم جديد</button>
                </div>
                
                <!-- Login Form -->
                <div id="login-form" class="p-6">
                    <h2 class="text-2xl font-bold mb-6 text-center">مرحبًا بعودتك</h2>
                    <div class="mb-4">
                        <label for="login-email" class="block mb-2 font-medium">البريد الإلكتروني</label>
                        <input type="email" id="login-email" class="input-field" placeholder="أدخل بريدك الإلكتروني">
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="block mb-2 font-medium">كلمة المرور</label>
                        <input type="password" id="login-password" class="input-field" placeholder="أدخل كلمة المرور">
                    </div>
                    <button id="login-button" class="primary-btn w-full py-3">تسجيل الدخول</button>
                </div>
                
                <!-- Register Form -->
                <div id="register-form" class="p-6 hidden">
                    <h2 class="text-2xl font-bold mb-6 text-center">تسجيل مستخدم جديد</h2>
                    <div class="mb-4">
                        <label for="register-name" class="block mb-2 font-medium">الاسم الكامل</label>
                        <input type="text" id="register-name" class="input-field" placeholder="أدخل اسمك الكامل">
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="block mb-2 font-medium">البريد الإلكتروني</label>
                        <input type="email" id="register-email" class="input-field" placeholder="أدخل بريدك الإلكتروني">
                    </div>
                    <div class="mb-4">
                        <label for="register-password" class="block mb-2 font-medium">كلمة المرور</label>
                        <input type="password" id="register-password" class="input-field" placeholder="أدخل كلمة المرور">
                    </div>
                    <div class="mb-6">
                        <label for="register-confirm" class="block mb-2 font-medium">تأكيد كلمة المرور</label>
                        <input type="password" id="register-confirm" class="input-field" placeholder="أكد كلمة المرور">
                    </div>
                    <button id="register-button" class="primary-btn w-full py-3">تسجيل مستخدم جديد</button>
                </div>
            </div>
        </section>

        <!-- Dashboard Section (initially hidden) -->
        <section id="dashboard-section" class="hidden">
            <!-- Sidebar -->
            <div class="sidebar bg-white shadow-lg dark:bg-gray-800 pt-6">
                <div class="px-6 mb-8">
                    <h2 class="text-xl font-bold">نظام مبيعات الدهانات</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Delta HCP</p>
                </div>
                
                <div class="px-4">
                    <div id="nav-dashboard" class="nav-item active">
                        <i class="fas fa-th-large"></i>
                        <span>لوحة التحكم</span>
                    </div>
                    <div id="nav-products" class="nav-item">
                        <i class="fas fa-paint-roller"></i>
                        <span>إدارة المنتجات</span>
                    </div>
                    <div id="nav-customers" class="nav-item">
                        <i class="fas fa-users"></i>
                        <span>إدارة العملاء</span>
                    </div>
                    <div id="nav-orders" class="nav-item">
                        <i class="fas fa-shopping-cart"></i>
                        <span>الطلبات</span>
                    </div>
                    <div id="nav-new-order" class="nav-item">
                        <i class="fas fa-plus-circle"></i>
                        <span>طلب جديد</span>
                    </div>
                    <div id="nav-invoices" class="nav-item">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>الفواتير</span>
                    </div>
                    <div id="nav-payments" class="nav-item">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>سداد العملاء</span>
                    </div>
                    <div id="nav-reports" class="nav-item">
                        <i class="fas fa-chart-bar"></i>
                        <span>التقارير</span>
                    </div>
                    <div id="nav-statements" class="nav-item">
                        <i class="fas fa-file-alt"></i>
                        <span>كشوف الحسابات</span>
                    </div>
                    <div id="nav-users" class="nav-item admin-only hidden">
                        <i class="fas fa-user-cog"></i>
                        <span>إدارة المستخدمين</span>
                    </div>
                </div>
                
                <div class="absolute bottom-0 left-0 right-0 p-4 border-t">
                    <div id="nav-logout" class="nav-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>تسجيل الخروج</span>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="main-content p-6">
                <!-- Toggle Sidebar Button -->
                <button id="toggle-sidebar" class="fixed top-4 right-4 z-20 bg-white dark:bg-gray-800 p-2 rounded-md shadow-md">
                    <i class="fas fa-bars"></i>
                </button>
                
                <!-- Dashboard Content -->
                <div id="dashboard-content" class="content-section">
                    <h1 class="text-2xl font-bold mb-6">لوحة التحكم</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div class="card p-4">
                            <h3 class="text-lg font-medium mb-2">إجمالي المبيعات</h3>
                            <p class="text-2xl font-bold" id="total-sales">0 ج.م</p>
                        </div>
                        <div class="card p-4">
                            <h3 class="text-lg font-medium mb-2">طلبات اليوم</h3>
                            <p class="text-2xl font-bold" id="todays-orders">0</p>
                        </div>
                        <div class="card p-4">
                            <h3 class="text-lg font-medium mb-2">المنتجات</h3>
                            <p class="text-2xl font-bold" id="total-products">0</p>
                        </div>
                        <div class="card p-4">
                            <h3 class="text-lg font-medium mb-2">العملاء</h3>
                            <p class="text-2xl font-bold" id="total-customers">0</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="card p-4">
                            <h3 class="text-lg font-medium mb-4">المبيعات الشهرية</h3>
                            <div class="h-64">
                                <canvas id="sales-chart"></canvas>
                            </div>
                        </div>
                        <div class="card p-4">
                            <h3 class="text-lg font-medium mb-4">أحدث الطلبات</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="py-2 px-4 text-right">رقم الطلب</th>
                                            <th class="py-2 px-4 text-right">العميل</th>
                                            <th class="py-2 px-4 text-right">التاريخ</th>
                                            <th class="py-2 px-4 text-right">المبلغ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-orders">
                                        <!-- سيتم ملء هذا القسم ديناميكيًا -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div id="products-content" class="content-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-2xl font-bold">إدارة المنتجات</h1>
                        <button id="add-product-button" class="primary-btn">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة منتج جديد
                        </button>
                    </div>
                    
                    <div class="card p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block mb-1 font-medium">البحث باسم المنتج</label>
                                <input type="text" id="product-search" class="input-field" placeholder="اكتب اسم المنتج...">
                            </div>
                            <div>
                                <label class="block mb-1 font-medium">تصفية حسب التصنيف</label>
                                <select id="product-category-filter" class="input-field">
                                    <option value="">جميع التصنيفات</option>
                                    <option value="إنشائي">إنشائي</option>
                                    <option value="واجهات خارجية">واجهات خارجية</option>
                                    <option value="ديكوري">ديكوري</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="product-search-button" class="primary-btn mr-2">بحث</button>
                                <button id="product-reset-button" class="secondary-btn">إعادة تعيين</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th class="py-3 px-4 text-right">اسم المنتج</th>
                                        <th class="py-3 px-4 text-right">التصنيف</th>
                                        <th class="py-3 px-4 text-right">الباتش/اللون</th>
                                        <th class="py-3 px-4 text-right">السعر</th>
                                        <th class="py-3 px-4 text-right">الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="products-table">
                                    <!-- سيتم ملء هذا القسم ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Customers Section -->
                <div id="customers-content" class="content-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-2xl font-bold">إدارة العملاء</h1>
                        <button id="add-customer-button" class="primary-btn">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة عميل جديد
                        </button>
                    </div>
                    
                    <div class="card p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block mb-1 font-medium">البحث باسم العميل</label>
                                <input type="text" id="customer-name-search" class="input-field" placeholder="اكتب اسم العميل...">
                            </div>
                            <div>
                                <label class="block mb-1 font-medium">البحث برقم الهاتف</label>
                                <input type="text" id="customer-phone-search" class="input-field" placeholder="اكتب رقم الهاتف...">
                            </div>
                            <div>
                                <label class="block mb-1 font-medium">تصفية حسب التصنيف</label>
                                <select id="customer-category-filter" class="input-field">
                                    <option value="">جميع التصنيفات</option>
                                    <option value="هيئات/مشاريع">هيئات/مشاريع</option>
                                    <option value="محلات">محلات</option>
                                    <option value="أهالي">أهالي</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th class="py-3 px-4 text-right">اسم العميل</th>
                                        <th class="py-3 px-4 text-right">رقم الهاتف</th>
                                        <th class="py-3 px-4 text-right">العنوان</th>
                                        <th class="py-3 px-4 text-right">التصنيف</th>
                                        <th class="py-3 px-4 text-right">نسبة الخصم</th>
                                        <th class="py-3 px-4 text-right">الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="customers-table">
                                    <!-- سيتم ملء هذا القسم ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Orders Section -->
                <div id="orders-content" class="content-section hidden">
                    <h1 class="text-2xl font-bold mb-6">الطلبات</h1>
                    
                    <div class="card p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block mb-1 font-medium">البحث برقم الطلب</label>
                                <input type="text" id="order-id-search" class="input-field" placeholder="اكتب رقم الطلب...">
                            </div>
                            <div>
                                <label class="block mb-1 font-medium">البحث باسم العميل</label>
                                <input type="text" id="order-customer-search" class="input-field" placeholder="اكتب اسم العميل...">
                            </div>
                            <div>
                                <label class="block mb-1 font-medium">البحث بالمنتج</label>
                                <input type="text" id="order-product-search" class="input-field" placeholder="اكتب اسم المنتج...">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block mb-1 font-medium">من تاريخ</label>
                                <input type="date" id="order-date-from" class="input-field">
                            </div>
                            <div>
                                <label class="block mb-1 font-medium">إلى تاريخ</label>
                                <input type="date" id="order-date-to" class="input-field">
                            </div>
                            <div class="flex items-end">
                                <button id="order-search-button" class="primary-btn mr-2">بحث</button>
                                <button id="order-reset-button" class="secondary-btn">إعادة تعيين</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th class="py-3 px-4 text-right">رقم الطلب</th>
                                        <th class="py-3 px-4 text-right">العميل</th>
                                        <th class="py-3 px-4 text-right">التاريخ</th>
                                        <th class="py-3 px-4 text-right">المبلغ قبل الخصم</th>
                                        <th class="py-3 px-4 text-right">الخصم</th>
                                        <th class="py-3 px-4 text-right">المبلغ النهائي</th>
                                        <th class="py-3 px-4 text-right">طريقة الدفع</th>
                                        <th class="py-3 px-4 text-right">الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-table">
                                    <!-- سيتم ملء هذا القسم ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- New Order Section -->
                <div id="new-order-content" class="content-section hidden">
                    <h1 class="text-2xl font-bold mb-6">إنشاء طلب جديد</h1>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="card p-4 lg:col-span-2">
                            <h3 class="text-lg font-medium mb-4">بيانات الطلب</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block mb-1 font-medium">رقم الطلب</label>
                                    <input type="text" id="new-order-id" class="input-field" readonly>
                                </div>
                                <div>
                                    <label class="block mb-1 font-medium">التاريخ</label>
                                    <input type="date" id="new-order-date" class="input-field">
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block mb-1 font-medium">العميل</label>
                                <select id="new-order-customer" class="input-field">
                                    <option value="">اختر العميل...</option>
                                    <!-- سيتم ملء هذا القسم ديناميكيًا -->
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block mb-1 font-medium">طريقة الدفع</label>
                                <select id="new-order-payment" class="input-field">
                                    <option value="نقدي">نقدي</option>
                                    <option value="تحويل بنكي">تحويل بنكي</option>
                                    <option value="شيك">شيك</option>
                                    <option value="فودافون كاش">فودافون كاش</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex items-center mb-2">
                                    <input type="checkbox" id="new-order-deposit-check" class="ml-2">
                                    <label for="new-order-deposit-check" class="font-medium">إضافة عربون</label>
                                </div>
                                <div id="new-order-deposit-container" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block mb-1">قيمة العربون</label>
                                        <input type="number" id="new-order-deposit" class="input-field" placeholder="أدخل قيمة العربون">
                                    </div>
                                    <div>
                                        <label class="block mb-1">طريقة دفع العربون</label>
                                        <select id="new-order-deposit-method" class="input-field">
                                            <option value="نقدي">نقدي</option>
                                            <option value="تحويل بنكي">تحويل بنكي</option>
                                            <option value="شيك">شيك</option>
                                            <option value="فودافون كاش">فودافون كاش</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block mb-1 font-medium">ملاحظات</label>
                                <textarea id="new-order-notes" class="input-field h-24" placeholder="أدخل ملاحظات إضافية..."></textarea>
                            </div>
                        </div>
                        
                        <div class="card p-4">
                            <h3 class="text-lg font-medium mb-4">ملخص الطلب</h3>
                            
                            <div class="mb-4 pb-4 border-b">
                                <div class="flex justify-between mb-2">
                                    <span>المبلغ قبل الخصم:</span>
                                    <span id="new-order-subtotal">0.00 ج.م</span>
                                </div>
                                <div class="flex justify-between mb-2">
                                    <span>الخصم:</span>
                                    <span id="new-order-discount">0.00 ج.م</span>
                                </div>
                                <div class="flex justify-between mb-2" id="new-order-deposit-row">
                                    <span>العربون:</span>
                                    <span id="new-order-deposit-summary">0.00 ج.م</span>
                                </div>
                            </div>
                            
                            <div class="flex justify-between font-bold text-lg">
                                <span>المبلغ النهائي:</span>
                                <span id="new-order-total">0.00 ج.م</span>
                            </div>
                            
                            <button id="create-order-button" class="primary-btn w-full mt-6">إنشاء الطلب</button>
                        </div>
                    </div>
                    
                    <div class="card p-4 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">المنتجات</h3>
                            <button id="add-product-to-order" class="primary-btn">
                                <i class="fas fa-plus ml-2"></i>
                                إضافة منتج
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th class="py-3 px-4 text-right">المنتج</th>
                                        <th class="py-3 px-4 text-right">الباتش/اللون</th>
                                        <th class="py-3 px-4 text-right">السعر</th>
                                        <th class="py-3 px-4 text-right">الكمية</th>
                                        <th class="py-3 px-4 text-right">الإجمالي</th>
                                        <th class="py-3 px-4 text-right">الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="order-products-table">
                                    <!-- سيتم ملء هذا القسم ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Other content sections will go here -->
            </div>
        </section>
    </div>

    <!-- Modals -->
    <!-- Add Product Modal -->
    <div id="add-product-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">إضافة منتج جديد</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">التصنيف</label>
                    <select id="product-category" class="input-field">
                        <option value="">اختر التصنيف...</option>
                        <option value="إنشائي">إنشائي</option>
                        <option value="واجهات خارجية">واجهات خارجية</option>
                        <option value="ديكوري">ديكوري</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">اسم المنتج</label>
                    <input type="text" id="product-name" class="input-field" placeholder="أدخل اسم المنتج">
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">الباتش/اللون</label>
                    <input type="text" id="product-batch" class="input-field" placeholder="أدخل رقم الباتش أو اللون">
                </div>
                
                <div class="mb-6">
                    <label class="block mb-1 font-medium">السعر</label>
                    <input type="number" id="product-price" class="input-field" placeholder="أدخل سعر المنتج">
                </div>
                
                <div class="flex justify-end">
                    <button class="close-modal secondary-btn mr-2">إلغاء</button>
                    <button id="save-product-button" class="primary-btn">حفظ المنتج</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Customer Modal -->
    <div id="add-customer-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">إضافة عميل جديد</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">اسم العميل</label>
                    <input type="text" id="customer-name" class="input-field" placeholder="أدخل اسم العميل">
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">رقم الهاتف</label>
                    <input type="text" id="customer-phone" class="input-field" placeholder="أدخل رقم الهاتف">
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">العنوان</label>
                    <textarea id="customer-address" class="input-field" placeholder="أدخل عنوان العميل"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">تصنيف العميل</label>
                    <select id="customer-category" class="input-field">
                        <option value="">اختر التصنيف...</option>
                        <option value="هيئات/مشاريع">هيئات/مشاريع</option>
                        <option value="محلات">محلات</option>
                        <option value="أهالي">أهالي</option>
                    </select>
                </div>
                
                <div class="mb-6">
                    <label class="block mb-1 font-medium">نسبة الخصم (%)</label>
                    <input type="number" id="customer-discount" class="input-field" placeholder="أدخل نسبة الخصم" min="0" max="100">
                </div>
                
                <div class="flex justify-end">
                    <button class="close-modal secondary-btn mr-2">إلغاء</button>
                    <button id="save-customer-button" class="primary-btn">حفظ العميل</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Product to Order Modal -->
    <div id="add-product-to-order-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">إضافة منتج للطلب</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">المنتج</label>
                    <select id="order-product" class="input-field">
                        <option value="">اختر المنتج...</option>
                        <!-- سيتم ملء هذا القسم ديناميكيًا -->
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">الباتش/اللون</label>
                    <select id="order-product-batch" class="input-field">
                        <option value="">اختر الباتش/اللون...</option>
                        <!-- سيتم ملء هذا القسم ديناميكيًا -->
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-1 font-medium">السعر</label>
                    <input type="number" id="order-product-price" class="input-field" readonly>
                </div>
                
                <div class="mb-6">
                    <label class="block mb-1 font-medium">الكمية</label>
                    <input type="number" id="order-product-quantity" class="input-field" min="1" value="1">
                </div>
                
                <div class="flex justify-end">
                    <button class="close-modal secondary-btn mr-2">إلغاء</button>
                    <button id="add-product-to-order-button" class="primary-btn">إضافة للطلب</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <!-- Main JavaScript -->
    <script>
        // Firebase initialization
        const firebaseConfig = {
            apiKey: "AIzaSyCpTjPsfaWTuNjpUupteqALjmb0qLUAzg8",
            authDomain: "delta-hcp.firebaseapp.com",
            projectId: "delta-hcp",
            storageBucket: "delta-hcp.firebasestorage.app",
            messagingSenderId: "956838180358",
            appId: "1:956838180358:web:af6abd7a430a8e17c83587",
            measurementId: "G-NJT5FCNJK3"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // DOM elements
        const loginTab = document.getElementById('login-tab');
        const registerTab = document.getElementById('register-tab');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginButton = document.getElementById('login-button');
        const registerButton = document.getElementById('register-button');
        const authSection = document.getElementById('auth-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const toggleSidebar = document.getElementById('toggle-sidebar');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        
        // Tab switching
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('border-b-2', 'border-primary-color', 'text-primary-color');
            registerTab.classList.remove('border-b-2', 'border-primary-color', 'text-primary-color');
            registerTab.classList.add('text-gray-500');
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
        });
        
        registerTab.addEventListener('click', () => {
            registerTab.classList.add('border-b-2', 'border-primary-color', 'text-primary-color');
            loginTab.classList.remove('border-b-2', 'border-primary-color', 'text-primary-color');
            loginTab.classList.add('text-gray-500');
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });
        
        // Authentication
        loginButton.addEventListener('click', async () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showAlert('خطأ', 'يرجى إدخال البريد الإلكتروني وكلمة المرور.', 'error');
                return;
            }
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                // سيتم التحويل للداشبورد عن طريق مستمع تسجيل الدخول
            } catch (error) {
                showAlert('خطأ في تسجيل الدخول', error.message, 'error');
            }
        });
        
        registerButton.addEventListener('click', async () => {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            
            if (!name || !email || !password || !confirmPassword) {
                showAlert('خطأ', 'يرجى إدخال جميع البيانات المطلوبة.', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showAlert('خطأ', 'كلمة المرور غير متطابقة.', 'error');
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // إضافة بيانات إضافية للمستخدم
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    role: 'user', // المستخدم الجديد له دور user بشكل افتراضي
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // تحديث اسم المستخدم في Firebase Authentication
                await userCredential.user.updateProfile({
                    displayName: name
                });
                
                showAlert('تم التسجيل بنجاح!', 'تم إنشاء حسابك بنجاح.', 'success');
                
                // سيتم التحويل للداشبورد عن طريق مستمع تسجيل الدخول
            } catch (error) {
                showAlert('خطأ في التسجيل', error.message, 'error');
            }
        });
        
        // Authentication state observer
        auth.onAuthStateChanged(async user => {
            if (user) {
                // تحقق من دور المستخدم
                const userDoc = await db.collection('users').doc(user.uid).get();
                let userRole = 'user'; // القيمة الافتراضية
                
                if (userDoc.exists) {
                    userRole = userDoc.data().role || 'user';
                } else {
                    // إذا لم يجد وثيقة المستخدم، قم بإنشائها
                    await db.collection('users').doc(user.uid).set({
                        name: user.displayName || '',
                        email: user.email,
                        role: 'user',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                // إظهار أو إخفاء الميزات حسب صلاحيات المستخدم
                if (userRole === 'admin') {
                    document.querySelectorAll('.admin-only').forEach(elem => {
                        elem.classList.remove('hidden');
                    });
                }
                
                // إخفاء قسم المصادقة وإظهار لوحة التحكم
                authSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                
                // تحميل البيانات بعد تسجيل الدخول
                loadDashboardData();
                
            } else {
                // إظهار قسم المصادقة وإخفاء لوحة التحكم
                authSection.classList.remove('hidden');
                dashboardSection.classList.add('hidden');
            }
        });
        
        // Sidebar toggling
        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('sidebar-collapsed');
            mainContent.classList.toggle('main-content-expanded');
        });
        
        // Mobile responsive sidebar
        function checkWindowSize() {
            if (window.innerWidth <= 768) {
                sidebar.classList.add('sidebar-collapsed');
                mainContent.classList.add('main-content-expanded');
                
                // للهواتف نخفي القائمة الجانبية تمامًا
                sidebar.classList.remove('sidebar-visible');
            } else {
                sidebar.classList.remove('sidebar-collapsed');
                mainContent.classList.remove('main-content-expanded');
            }
        }
        
        window.addEventListener('resize', checkWindowSize);
        checkWindowSize(); // التحقق عند بدء التطبيق
        
        // Toggle sidebar visibility on mobile
        toggleSidebar.addEventListener('click', () => {
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('sidebar-visible');
            } else {
                sidebar.classList.toggle('sidebar-collapsed');
                mainContent.classList.toggle('main-content-expanded');
            }
        });
        
        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                // إزالة الفئة النشطة من جميع عناصر التنقل
                navItems.forEach(nav => nav.classList.remove('active'));
                
                // إضافة الفئة النشطة للعنصر الذي تم النقر عليه
                item.classList.add('active');
                
                // إخفاء القائمة الجانبية في الأجهزة المحمولة بعد النقر
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('sidebar-visible');
                }
                
                // عرض القسم المناسب
                const contentId = item.id.replace('nav-', '') + '-content';
                
                contentSections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                const targetSection = document.getElementById(contentId);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                }
                
                // خاص بتسجيل الخروج
                if (item.id === 'nav-logout') {
                    auth.signOut().then(() => {
                        showAlert('تم تسجيل الخروج', 'تم تسجيل خروجك بنجاح', 'success');
                    }).catch(error => {
                        showAlert('خطأ', 'حدث خطأ أثناء تسجيل الخروج', 'error');
                    });
                }
            });
        });
        
        // Modal handling
        document.getElementById('add-product-button').addEventListener('click', () => {
            openModal('add-product-modal');
        });
        
        document.getElementById('add-customer-button').addEventListener('click', () => {
            openModal('add-customer-modal');
        });
        
        document.getElementById('add-product-to-order').addEventListener('click', () => {
            loadProductsForOrder();
            openModal('add-product-to-order-modal');
        });
        
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', (e) => {
                const modal = e.target.closest('[id$=-modal]');
                if (modal) {
                    closeModal(modal.id);
                }
            });
        });
        
        // إغلاق المودل عند النقر خارجه
        document.querySelectorAll('[id$=-modal]').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal.id);
                }
            });
        });
        
        // توليد رقم طلب جديد
        function generateOrderId() {
            const date = new Date();
            const year = date.getFullYear().toString().substr(-2);
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            return `ORD-${year}${month}${day}-${random}`;
        }
        
        // تحميل بيانات لوحة التحكم
        async function loadDashboardData() {
            try {
                // تحميل إحصائيات المبيعات
                const totalSalesElement = document.getElementById('total-sales');
                const todaysOrdersElement = document.getElementById('todays-orders');
                const totalProductsElement = document.getElementById('total-products');
                const totalCustomersElement = document.getElementById('total-customers');
                
                // إحصائيات المنتجات
                const productsSnapshot = await db.collection('products').get();
                const totalProducts = productsSnapshot.size;
                totalProductsElement.textContent = totalProducts;
                
                // إحصائيات العملاء
                const customersSnapshot = await db.collection('customers').get();
                const totalCustomers = customersSnapshot.size;
                totalCustomersElement.textContent = totalCustomers;
                
                // إحصائيات الطلبات
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const ordersSnapshot = await db.collection('orders').get();
                let totalSales = 0;
                let todaysOrders = 0;
                
                ordersSnapshot.forEach(doc => {
                    const orderData = doc.data();
                    totalSales += Number(orderData.totalAfterDiscount || 0);
                    
                    const orderDate = orderData.date ? new Date(orderData.date.seconds * 1000) : null;
                    if (orderDate && orderDate >= today) {
                        todaysOrders++;
                    }
                });
                
                totalSalesElement.textContent = totalSales.toLocaleString() + ' ج.م';
                todaysOrdersElement.textContent = todaysOrders;
                
                // تحميل أحدث الطلبات
                loadRecentOrders();
                
                // رسم بياني للمبيعات الشهرية
                createSalesChart();
                
                // تحميل المنتجات
                loadProducts();
                
                // تحميل العملاء
                loadCustomers();
                
                // تحميل الطلبات
                loadOrders();
                
                // تحضير صفحة الطلب الجديد
                prepareNewOrderPage();
                
            } catch (error) {
                console.error("Error loading dashboard data: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء تحميل البيانات', 'error');
            }
        }
        
        // تحميل أحدث الطلبات
        async function loadRecentOrders() {
            try {
                const recentOrdersTable = document.getElementById('recent-orders');
                recentOrdersTable.innerHTML = '';
                
                const ordersSnapshot = await db.collection('orders')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                if (ordersSnapshot.empty) {
                    recentOrdersTable.innerHTML = `
                        <tr>
                            <td colspan="4" class="py-4 text-center text-gray-500">لا توجد طلبات حتى الآن</td>
                        </tr>
                    `;
                    return;
                }
                
                const ordersPromises = ordersSnapshot.docs.map(async doc => {
                    const orderData = doc.data();
                    
                    // الحصول على بيانات العميل
                    let customerName = 'غير معروف';
                    if (orderData.customerId) {
                        const customerDoc = await db.collection('customers').doc(orderData.customerId).get();
                        if (customerDoc.exists) {
                            customerName = customerDoc.data().name;
                        }
                    }
                    
                    const date = orderData.date ? new Date(orderData.date.seconds * 1000) : new Date();
                    const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                    
                    return `
                        <tr class="border-b">
                            <td class="py-3 px-4">${orderData.orderId || doc.id}</td>
                            <td class="py-3 px-4">${customerName}</td>
                            <td class="py-3 px-4">${formattedDate}</td>
                            <td class="py-3 px-4">${Number(orderData.totalAfterDiscount || 0).toLocaleString()} ج.م</td>
                        </tr>
                    `;
                });
                
                const ordersHtml = await Promise.all(ordersPromises);
                recentOrdersTable.innerHTML = ordersHtml.join('');
                
            } catch (error) {
                console.error("Error loading recent orders: ", error);
            }
        }
        
        // إنشاء رسم بياني للمبيعات
        function createSalesChart() {
            const ctx = document.getElementById('sales-chart').getContext('2d');
            
            // بيانات مثال (ستُستبدَل ببيانات حقيقية لاحقًا)
            const data = {
                labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو'],
                datasets: [{
                    label: 'المبيعات الشهرية (ج.م)',
                    data: [12000, 19000, 15000, 25000, 22000, 30000],
                    backgroundColor: 'rgba(93, 92, 222, 0.2)',
                    borderColor: 'rgba(93, 92, 222, 1)',
                    borderWidth: 2,
                    tension: 0.3
                }]
            };
            
            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // حفظ منتج جديد
        document.getElementById('save-product-button').addEventListener('click', async () => {
            const category = document.getElementById('product-category').value;
            const name = document.getElementById('product-name').value;
            const batch = document.getElementById('product-batch').value;
            const price = parseFloat(document.getElementById('product-price').value);
            
            if (!category || !name || !batch || isNaN(price) || price <= 0) {
                showAlert('خطأ', 'يرجى إدخال جميع بيانات المنتج بشكل صحيح', 'error');
                return;
            }
            
            try {
                // التحقق من وجود منتج مشابه
                const existingProduct = await db.collection('products')
                    .where('name', '==', name)
                    .where('batch', '==', batch)
                    .get();
                
                if (!existingProduct.empty) {
                    showAlert('تحذير', 'يوجد منتج بنفس الاسم والباتش بالفعل!', 'warning');
                    return;
                }
                
                // إضافة المنتج الجديد
                await db.collection('products').add({
                    category,
                    name,
                    batch,
                    price,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showAlert('تم بنجاح', 'تم إضافة المنتج بنجاح', 'success');
                
                // إعادة تحميل المنتجات وإغلاق الموديل
                loadProducts();
                closeModal('add-product-modal');
                
                // مسح حقول الموديل
                document.getElementById('product-category').value = '';
                document.getElementById('product-name').value = '';
                document.getElementById('product-batch').value = '';
                document.getElementById('product-price').value = '';
                
            } catch (error) {
                console.error("Error adding product: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء إضافة المنتج', 'error');
            }
        });
        
        // حفظ عميل جديد
        document.getElementById('save-customer-button').addEventListener('click', async () => {
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const address = document.getElementById('customer-address').value;
            const category = document.getElementById('customer-category').value;
            const discount = parseFloat(document.getElementById('customer-discount').value || 0);
            
            if (!name || !phone) {
                showAlert('خطأ', 'يرجى إدخال اسم العميل ورقم الهاتف على الأقل', 'error');
                return;
            }
            
            if (discount < 0 || discount > 100) {
                showAlert('خطأ', 'نسبة الخصم يجب أن تكون بين 0 و 100', 'error');
                return;
            }
            
            try {
                // التحقق من وجود عميل بنفس رقم الهاتف
                const existingCustomer = await db.collection('customers')
                    .where('phone', '==', phone)
                    .get();
                
                if (!existingCustomer.empty) {
                    showAlert('تحذير', 'يوجد عميل بنفس رقم الهاتف بالفعل!', 'warning');
                    return;
                }
                
                // إضافة العميل الجديد
                await db.collection('customers').add({
                    name,
                    phone,
                    address,
                    category,
                    discount,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showAlert('تم بنجاح', 'تم إضافة العميل بنجاح', 'success');
                
                // إعادة تحميل العملاء وإغلاق الموديل
                loadCustomers();
                closeModal('add-customer-modal');
                
                // مسح حقول الموديل
                document.getElementById('customer-name').value = '';
                document.getElementById('customer-phone').value = '';
                document.getElementById('customer-address').value = '';
                document.getElementById('customer-category').value = '';
                document.getElementById('customer-discount').value = '';
                
            } catch (error) {
                console.error("Error adding customer: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء إضافة العميل', 'error');
            }
        });
        
        // تحميل المنتجات
        async function loadProducts() {
            try {
                const productsTable = document.getElementById('products-table');
                productsTable.innerHTML = '<tr><td colspan="5" class="py-4 text-center">جاري تحميل البيانات...</td></tr>';
                
                const snapshot = await db.collection('products').orderBy('createdAt', 'desc').get();
                
                if (snapshot.empty) {
                    productsTable.innerHTML = '<tr><td colspan="5" class="py-4 text-center text-gray-500">لا توجد منتجات حتى الآن</td></tr>';
                    return;
                }
                
                let productsHtml = '';
                
                snapshot.forEach(doc => {
                    const product = doc.data();
                    productsHtml += `
                        <tr class="border-b hover:bg-gray-50 dark:hover:bg-gray-700">
                            <td class="py-3 px-4">${product.name}</td>
                            <td class="py-3 px-4">${product.category}</td>
                            <td class="py-3 px-4">${product.batch}</td>
                            <td class="py-3 px-4">${Number(product.price).toLocaleString()} ج.م</td>
                            <td class="py-3 px-4">
                                <button class="edit-product mr-2 text-blue-500" data-id="${doc.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-product text-red-500" data-id="${doc.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                productsTable.innerHTML = productsHtml;
                
                // إضافة مستمعي الأحداث لأزرار التعديل والحذف
                document.querySelectorAll('.edit-product').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.currentTarget.getAttribute('data-id');
                        editProduct(productId);
                    });
                });
                
                document.querySelectorAll('.delete-product').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = e.currentTarget.getAttribute('data-id');
                        deleteProduct(productId);
                    });
                });
                
            } catch (error) {
                console.error("Error loading products: ", error);
                document.getElementById('products-table').innerHTML = '<tr><td colspan="5" class="py-4 text-center text-red-500">حدث خطأ أثناء تحميل البيانات</td></tr>';
            }
        }
        
        // تحميل العملاء
        async function loadCustomers() {
            try {
                const customersTable = document.getElementById('customers-table');
                customersTable.innerHTML = '<tr><td colspan="6" class="py-4 text-center">جاري تحميل البيانات...</td></tr>';
                
                const snapshot = await db.collection('customers').orderBy('createdAt', 'desc').get();
                
                if (snapshot.empty) {
                    customersTable.innerHTML = '<tr><td colspan="6" class="py-4 text-center text-gray-500">لا يوجد عملاء حتى الآن</td></tr>';
                    return;
                }
                
                let customersHtml = '';
                
                snapshot.forEach(doc => {
                    const customer = doc.data();
                    customersHtml += `
                        <tr class="border-b hover:bg-gray-50 dark:hover:bg-gray-700">
                            <td class="py-3 px-4">${customer.name}</td>
                            <td class="py-3 px-4">${customer.phone}</td>
                            <td class="py-3 px-4">${customer.address || '-'}</td>
                            <td class="py-3 px-4">${customer.category || '-'}</td>
                            <td class="py-3 px-4">${customer.discount || 0}%</td>
                            <td class="py-3 px-4">
                                <button class="edit-customer mr-2 text-blue-500" data-id="${doc.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-customer text-red-500" data-id="${doc.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                customersTable.innerHTML = customersHtml;
                
                // إضافة مستمعي الأحداث لأزرار التعديل والحذف
                document.querySelectorAll('.edit-customer').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const customerId = e.currentTarget.getAttribute('data-id');
                        editCustomer(customerId);
                    });
                });
                
                document.querySelectorAll('.delete-customer').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const customerId = e.currentTarget.getAttribute('data-id');
                        deleteCustomer(customerId);
                    });
                });
                
                // تحميل العملاء في قائمة الطلبات الجديدة
                const customerSelect = document.getElementById('new-order-customer');
                if (customerSelect) {
                    customerSelect.innerHTML = '<option value="">اختر العميل...</option>';
                    
                    snapshot.forEach(doc => {
                        const customer = doc.data();
                        customerSelect.innerHTML += `<option value="${doc.id}" data-discount="${customer.discount || 0}">${customer.name} - ${customer.phone}</option>`;
                    });
                }
                
            } catch (error) {
                console.error("Error loading customers: ", error);
                document.getElementById('customers-table').innerHTML = '<tr><td colspan="6" class="py-4 text-center text-red-500">حدث خطأ أثناء تحميل البيانات</td></tr>';
            }
        }
        
        // تحميل الطلبات
        async function loadOrders() {
            try {
                const ordersTable = document.getElementById('orders-table');
                if (!ordersTable) return;
                
                ordersTable.innerHTML = '<tr><td colspan="8" class="py-4 text-center">جاري تحميل البيانات...</td></tr>';
                
                const snapshot = await db.collection('orders').orderBy('createdAt', 'desc').get();
                
                if (snapshot.empty) {
                    ordersTable.innerHTML = '<tr><td colspan="8" class="py-4 text-center text-gray-500">لا توجد طلبات حتى الآن</td></tr>';
                    return;
                }
                
                const ordersPromises = snapshot.docs.map(async doc => {
                    const order = doc.data();
                    
                    // الحصول على بيانات العميل
                    let customerName = 'غير معروف';
                    if (order.customerId) {
                        const customerDoc = await db.collection('customers').doc(order.customerId).get();
                        if (customerDoc.exists) {
                            customerName = customerDoc.data().name;
                        }
                    }
                    
                    const date = order.date ? new Date(order.date.seconds * 1000) : new Date();
                    const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                    
                    return `
                        <tr class="border-b hover:bg-gray-50 dark:hover:bg-gray-700">
                            <td class="py-3 px-4">${order.orderId || doc.id}</td>
                            <td class="py-3 px-4">${customerName}</td>
                            <td class="py-3 px-4">${formattedDate}</td>
                            <td class="py-3 px-4">${Number(order.subtotal || 0).toLocaleString()} ج.م</td>
                            <td class="py-3 px-4">${Number(order.discountAmount || 0).toLocaleString()} ج.م (${order.discountPercent || 0}%)</td>
                            <td class="py-3 px-4">${Number(order.totalAfterDiscount || 0).toLocaleString()} ج.م</td>
                            <td class="py-3 px-4">${order.paymentMethod || '-'}</td>
                            <td class="py-3 px-4">
                                <button class="view-order mr-2 text-green-500" data-id="${doc.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="print-order mr-2 text-blue-500" data-id="${doc.id}">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button class="delete-order text-red-500" data-id="${doc.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                const ordersHtml = await Promise.all(ordersPromises);
                ordersTable.innerHTML = ordersHtml.join('');
                
                // إضافة مستمعي الأحداث لأزرار المشاهدة والطباعة والحذف
                document.querySelectorAll('.view-order').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = e.currentTarget.getAttribute('data-id');
                        viewOrder(orderId);
                    });
                });
                
                document.querySelectorAll('.print-order').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = e.currentTarget.getAttribute('data-id');
                        printOrder(orderId);
                    });
                });
                
                document.querySelectorAll('.delete-order').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = e.currentTarget.getAttribute('data-id');
                        deleteOrder(orderId);
                    });
                });
                
            } catch (error) {
                console.error("Error loading orders: ", error);
                const ordersTable = document.getElementById('orders-table');
                if (ordersTable) {
                    ordersTable.innerHTML = '<tr><td colspan="8" class="py-4 text-center text-red-500">حدث خطأ أثناء تحميل البيانات</td></tr>';
                }
            }
        }
        
        // تحضير صفحة الطلب الجديد
        function prepareNewOrderPage() {
            // توليد رقم طلب جديد
            document.getElementById('new-order-id').value = generateOrderId();
            
            // تعيين تاريخ اليوم
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('new-order-date').value = today;
            
            // تفعيل/تعطيل حقول العربون
            const depositCheck = document.getElementById('new-order-deposit-check');
            const depositContainer = document.getElementById('new-order-deposit-container');
            const depositRow = document.getElementById('new-order-deposit-row');
            
            depositCheck.addEventListener('change', () => {
                if (depositCheck.checked) {
                    depositContainer.classList.remove('hidden');
                    depositRow.classList.remove('hidden');
                } else {
                    depositContainer.classList.add('hidden');
                    depositRow.classList.add('hidden');
                    document.getElementById('new-order-deposit').value = '';
                    document.getElementById('new-order-deposit-summary').textContent = '0.00 ج.م';
                    calculateOrderTotal();
                }
            });
            
            // إعادة حساب المجموع عند تغيير قيمة العربون
            document.getElementById('new-order-deposit').addEventListener('input', () => {
                const deposit = parseFloat(document.getElementById('new-order-deposit').value) || 0;
                document.getElementById('new-order-deposit-summary').textContent = deposit.toLocaleString() + ' ج.م';
                calculateOrderTotal();
            });
            
            // تحديث الخصم عند تغيير العميل
            document.getElementById('new-order-customer').addEventListener('change', () => {
                calculateOrderTotal();
            });
            
            // مصفوفة لتخزين المنتجات المضافة للطلب
            window.orderProducts = [];
            
            // إنشاء طلب جديد
            document.getElementById('create-order-button').addEventListener('click', createNewOrder);
            
            // إضافة منتج للطلب
            document.getElementById('add-product-to-order-button').addEventListener('click', addProductToOrder);
        }
        
        // تحميل المنتجات للطلب
        async function loadProductsForOrder() {
            try {
                const productSelect = document.getElementById('order-product');
                productSelect.innerHTML = '<option value="">اختر المنتج...</option>';
                
                const snapshot = await db.collection('products').get();
                
                // تجميع المنتجات حسب الاسم
                const productGroups = {};
                
                snapshot.forEach(doc => {
                    const product = doc.data();
                    
                    if (!productGroups[product.name]) {
                        productGroups[product.name] = {
                            name: product.name,
                            category: product.category,
                            batches: []
                        };
                    }
                    
                    productGroups[product.name].batches.push({
                        id: doc.id,
                        batch: product.batch,
                        price: product.price
                    });
                });
                
                // إضافة المنتجات للقائمة المنسدلة
                for (const productName in productGroups) {
                    const product = productGroups[productName];
                    productSelect.innerHTML += `<option value="${productName}" data-category="${product.category}">${productName} (${product.category})</option>`;
                }
                
                // تحديث الباتشات عند اختيار منتج
                productSelect.addEventListener('change', () => {
                    const selectedProduct = productSelect.value;
                    const batchSelect = document.getElementById('order-product-batch');
                    const priceInput = document.getElementById('order-product-price');
                    
                    batchSelect.innerHTML = '<option value="">اختر الباتش/اللون...</option>';
                    priceInput.value = '';
                    
                    if (selectedProduct && productGroups[selectedProduct]) {
                        const batches = productGroups[selectedProduct].batches;
                        
                        batches.forEach(batch => {
                            batchSelect.innerHTML += `<option value="${batch.id}" data-price="${batch.price}">${batch.batch}</option>`;
                        });
                    }
                });
                
                // تحديث السعر عند اختيار باتش
                document.getElementById('order-product-batch').addEventListener('change', () => {
                    const batchSelect = document.getElementById('order-product-batch');
                    const priceInput = document.getElementById('order-product-price');
                    
                    const selectedOption = batchSelect.options[batchSelect.selectedIndex];
                    if (selectedOption && selectedOption.value) {
                        priceInput.value = selectedOption.getAttribute('data-price');
                    } else {
                        priceInput.value = '';
                    }
                });
                
            } catch (error) {
                console.error("Error loading products for order: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء تحميل المنتجات', 'error');
            }
        }
        
        // إضافة منتج للطلب
        function addProductToOrder() {
            const productSelect = document.getElementById('order-product');
            const batchSelect = document.getElementById('order-product-batch');
            const priceInput = document.getElementById('order-product-price');
            const quantityInput = document.getElementById('order-product-quantity');
            
            const productId = batchSelect.value;
            const productName = productSelect.value;
            const batchName = batchSelect.options[batchSelect.selectedIndex]?.text || '';
            const price = parseFloat(priceInput.value);
            const quantity = parseInt(quantityInput.value);
            
            if (!productId || !productName || !batchName || isNaN(price) || price <= 0 || isNaN(quantity) || quantity <= 0) {
                showAlert('خطأ', 'يرجى اختيار المنتج والباتش وتحديد الكمية بشكل صحيح', 'error');
                return;
            }
            
            // التحقق من وجود المنتج بالفعل في الطلب
            const existingProductIndex = window.orderProducts.findIndex(p => p.productId === productId);
            
            if (existingProductIndex !== -1) {
                // تحديث الكمية إذا كان المنتج موجودًا بالفعل
                window.orderProducts[existingProductIndex].quantity += quantity;
                window.orderProducts[existingProductIndex].total = window.orderProducts[existingProductIndex].price * window.orderProducts[existingProductIndex].quantity;
            } else {
                // إضافة منتج جديد
                window.orderProducts.push({
                    productId,
                    productName,
                    batchName,
                    price,
                    quantity,
                    total: price * quantity
                });
            }
            
            updateOrderProductsTable();
            calculateOrderTotal();
            closeModal('add-product-to-order-modal');
            
            // مسح حقول الموديل
            productSelect.value = '';
            batchSelect.innerHTML = '<option value="">اختر الباتش/اللون...</option>';
            priceInput.value = '';
            quantityInput.value = '1';
        }
        
        // تحديث جدول منتجات الطلب
        function updateOrderProductsTable() {
            const table = document.getElementById('order-products-table');
            
            if (window.orderProducts.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="6" class="py-4 text-center text-gray-500">لم يتم إضافة منتجات بعد</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            window.orderProducts.forEach((product, index) => {
                html += `
                    <tr class="border-b">
                        <td class="py-3 px-4">${product.productName}</td>
                        <td class="py-3 px-4">${product.batchName}</td>
                        <td class="py-3 px-4">${Number(product.price).toLocaleString()} ج.م</td>
                        <td class="py-3 px-4">
                            <input type="number" class="input-field product-quantity" data-index="${index}" value="${product.quantity}" min="1" style="width: 70px;">
                        </td>
                        <td class="py-3 px-4">${Number(product.total).toLocaleString()} ج.م</td>
                        <td class="py-3 px-4">
                            <button class="delete-product-from-order text-red-500" data-index="${index}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            table.innerHTML = html;
            
            // إضافة مستمع لتغيير الكمية
            document.querySelectorAll('.product-quantity').forEach(input => {
                input.addEventListener('change', (e) => {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    const newQuantity = parseInt(e.target.value);
                    
                    if (isNaN(newQuantity) || newQuantity <= 0) {
                        e.target.value = window.orderProducts[index].quantity;
                        return;
                    }
                    
                    window.orderProducts[index].quantity = newQuantity;
                    window.orderProducts[index].total = window.orderProducts[index].price * newQuantity;
                    
                    updateOrderProductsTable();
                    calculateOrderTotal();
                });
            });
            
            // إضافة مستمع لحذف المنتج
            document.querySelectorAll('.delete-product-from-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.getAttribute('data-index'));
                    window.orderProducts.splice(index, 1);
                    
                    updateOrderProductsTable();
                    calculateOrderTotal();
                });
            });
        }
        
        // حساب إجمالي الطلب
        function calculateOrderTotal() {
            let subtotal = 0;
            
            window.orderProducts.forEach(product => {
                subtotal += product.total;
            });
            
            const customerSelect = document.getElementById('new-order-customer');
            const selectedOption = customerSelect.options[customerSelect.selectedIndex];
            const discountPercent = selectedOption ? parseFloat(selectedOption.getAttribute('data-discount')) || 0 : 0;
            
            const discountAmount = subtotal * (discountPercent / 100);
            let total = subtotal - discountAmount;
            
            // طرح العربون إذا كان موجودًا
            const depositCheck = document.getElementById('new-order-deposit-check');
            if (depositCheck.checked) {
                const deposit = parseFloat(document.getElementById('new-order-deposit').value) || 0;
                total -= deposit;
            }
            
            // تحديث العناصر في واجهة المستخدم
            document.getElementById('new-order-subtotal').textContent = subtotal.toLocaleString() + ' ج.م';
            document.getElementById('new-order-discount').textContent = discountAmount.toLocaleString() + ' ج.م (' + discountPercent + '%)';
            document.getElementById('new-order-total').textContent = total.toLocaleString() + ' ج.م';
        }
        
        // إنشاء طلب جديد
        async function createNewOrder() {
            const orderId = document.getElementById('new-order-id').value;
            const date = document.getElementById('new-order-date').value;
            const customerId = document.getElementById('new-order-customer').value;
            const paymentMethod = document.getElementById('new-order-payment').value;
            const notes = document.getElementById('new-order-notes').value;
            
            // العربون
            const depositCheck = document.getElementById('new-order-deposit-check');
            let deposit = 0;
            let depositMethod = '';
            
            if (depositCheck.checked) {
                deposit = parseFloat(document.getElementById('new-order-deposit').value) || 0;
                depositMethod = document.getElementById('new-order-deposit-method').value;
            }
            
            if (!orderId || !date || !customerId || window.orderProducts.length === 0) {
                showAlert('خطأ', 'يرجى إدخال جميع البيانات المطلوبة وإضافة منتج واحد على الأقل', 'error');
                return;
            }
            
            try {
                // الحصول على بيانات العميل
                const customerDoc = await db.collection('customers').doc(customerId).get();
                if (!customerDoc.exists) {
                    showAlert('خطأ', 'العميل غير موجود', 'error');
                    return;
                }
                
                const customerData = customerDoc.data();
                const discountPercent = parseFloat(customerData.discount) || 0;
                
                // حساب الإجماليات
                let subtotal = 0;
                window.orderProducts.forEach(product => {
                    subtotal += product.total;
                });
                
                const discountAmount = subtotal * (discountPercent / 100);
                const totalAfterDiscount = subtotal - discountAmount - deposit;
                
                // إنشاء الطلب
                await db.collection('orders').add({
                    orderId,
                    date: firebase.firestore.Timestamp.fromDate(new Date(date)),
                    customerId,
                    customerName: customerData.name,
                    products: window.orderProducts,
                    subtotal,
                    discountPercent,
                    discountAmount,
                    deposit,
                    depositMethod: deposit > 0 ? depositMethod : '',
                    totalAfterDiscount,
                    paymentMethod,
                    notes,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: auth.currentUser.uid
                });
                
                showAlert('تم بنجاح', 'تم إنشاء الطلب بنجاح', 'success');
                
                // إعادة تحميل البيانات
                loadOrders();
                loadRecentOrders();
                
                // إعادة تعيين النموذج
                resetNewOrderForm();
                
                // الانتقال إلى صفحة الطلبات
                document.getElementById('nav-orders').click();
                
            } catch (error) {
                console.error("Error creating order: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء إنشاء الطلب', 'error');
            }
        }
        
        // إعادة تعيين نموذج الطلب الجديد
        function resetNewOrderForm() {
            document.getElementById('new-order-id').value = generateOrderId();
            document.getElementById('new-order-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('new-order-customer').value = '';
            document.getElementById('new-order-payment').value = 'نقدي';
            document.getElementById('new-order-notes').value = '';
            document.getElementById('new-order-deposit-check').checked = false;
            document.getElementById('new-order-deposit-container').classList.add('hidden');
            document.getElementById('new-order-deposit-row').classList.add('hidden');
            document.getElementById('new-order-deposit').value = '';
            document.getElementById('new-order-deposit-summary').textContent = '0.00 ج.م';
            
            window.orderProducts = [];
            updateOrderProductsTable();
            calculateOrderTotal();
        }
        
        // عرض تنبيه
        function showAlert(title, message, icon) {
            Swal.fire({
                title: title,
                text: message,
                icon: icon,
                confirmButtonText: 'موافق',
                confirmButtonColor: '#5D5CDE'
            });
        }
        
        // حذف منتج
        async function deleteProduct(productId) {
            try {
                const result = await Swal.fire({
                    title: 'هل أنت متأكد؟',
                    text: 'سيتم حذف هذا المنتج نهائيًا!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'نعم، احذف',
                    cancelButtonText: 'إلغاء'
                });
                
                if (result.isConfirmed) {
                    await db.collection('products').doc(productId).delete();
                    showAlert('تم الحذف', 'تم حذف المنتج بنجاح', 'success');
                    loadProducts();
                }
            } catch (error) {
                console.error("Error deleting product: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء حذف المنتج', 'error');
            }
        }
        
        // تعديل منتج
        async function editProduct(productId) {
            try {
                const doc = await db.collection('products').doc(productId).get();
                if (!doc.exists) {
                    showAlert('خطأ', 'المنتج غير موجود', 'error');
                    return;
                }
                
                const product = doc.data();
                
                // تعديل موديل إضافة المنتج ليصبح للتعديل
                document.getElementById('product-category').value = product.category;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-batch').value = product.batch;
                document.getElementById('product-price').value = product.price;
                
                // تغيير نص زر الحفظ
                const saveButton = document.getElementById('save-product-button');
                saveButton.textContent = 'تحديث المنتج';
                
                // تغيير العنوان
                document.querySelector('#add-product-modal h3').textContent = 'تعديل المنتج';
                
                // إضافة معرف المنتج كسمة للزر
                saveButton.setAttribute('data-id', productId);
                
                // تغيير وظيفة زر الحفظ للتعديل بدلاً من الإضافة
                saveButton.removeEventListener('click', saveButton.clickHandler);
                saveButton.clickHandler = async () => {
                    const category = document.getElementById('product-category').value;
                    const name = document.getElementById('product-name').value;
                    const batch = document.getElementById('product-batch').value;
                    const price = parseFloat(document.getElementById('product-price').value);
                    
                    if (!category || !name || !batch || isNaN(price) || price <= 0) {
                        showAlert('خطأ', 'يرجى إدخال جميع بيانات المنتج بشكل صحيح', 'error');
                        return;
                    }
                    
                    try {
                        await db.collection('products').doc(productId).update({
                            category,
                            name,
                            batch,
                            price,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        showAlert('تم بنجاح', 'تم تحديث المنتج بنجاح', 'success');
                        
                        // إعادة تحميل المنتجات وإغلاق الموديل
                        loadProducts();
                        closeModal('add-product-modal');
                        
                        // إعادة تعيين الموديل
                        resetProductModal();
                        
                    } catch (error) {
                        console.error("Error updating product: ", error);
                        showAlert('خطأ', 'حدث خطأ أثناء تحديث المنتج', 'error');
                    }
                };
                
                saveButton.addEventListener('click', saveButton.clickHandler);
                
                // فتح الموديل
                openModal('add-product-modal');
                
            } catch (error) {
                console.error("Error editing product: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء تحميل بيانات المنتج', 'error');
            }
        }
        
        // إعادة تعيين موديل المنتج
        function resetProductModal() {
            document.getElementById('product-category').value = '';
            document.getElementById('product-name').value = '';
            document.getElementById('product-batch').value = '';
            document.getElementById('product-price').value = '';
            
            const saveButton = document.getElementById('save-product-button');
            saveButton.textContent = 'حفظ المنتج';
            saveButton.removeAttribute('data-id');
            
            document.querySelector('#add-product-modal h3').textContent = 'إضافة منتج جديد';
            
            // إعادة مستمع الإضافة الافتراضي
            if (saveButton.clickHandler) {
                saveButton.removeEventListener('click', saveButton.clickHandler);
            }
            
            saveButton.addEventListener('click', async () => {
                const category = document.getElementById('product-category').value;
                const name = document.getElementById('product-name').value;
                const batch = document.getElementById('product-batch').value;
                const price = parseFloat(document.getElementById('product-price').value);
                
                if (!category || !name || !batch || isNaN(price) || price <= 0) {
                    showAlert('خطأ', 'يرجى إدخال جميع بيانات المنتج بشكل صحيح', 'error');
                    return;
                }
                
                try {
                    // التحقق من وجود منتج مشابه
                    const existingProduct = await db.collection('products')
                        .where('name', '==', name)
                        .where('batch', '==', batch)
                        .get();
                    
                    if (!existingProduct.empty) {
                        showAlert('تحذير', 'يوجد منتج بنفس الاسم والباتش بالفعل!', 'warning');
                        return;
                    }
                    
                    // إضافة المنتج الجديد
                    await db.collection('products').add({
                        category,
                        name,
                        batch,
                        price,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showAlert('تم بنجاح', 'تم إضافة المنتج بنجاح', 'success');
                    
                    // إعادة تحميل المنتجات وإغلاق الموديل
                    loadProducts();
                    closeModal('add-product-modal');
                    
                    // مسح حقول الموديل
                    document.getElementById('product-category').value = '';
                    document.getElementById('product-name').value = '';
                    document.getElementById('product-batch').value = '';
                    document.getElementById('product-price').value = '';
                    
                } catch (error) {
                    console.error("Error adding product: ", error);
                    showAlert('خطأ', 'حدث خطأ أثناء إضافة المنتج', 'error');
                }
            });
        }
        
        // مشاهدة تفاصيل الطلب
        async function viewOrder(orderId) {
            try {
                const doc = await db.collection('orders').doc(orderId).get();
                if (!doc.exists) {
                    showAlert('خطأ', 'الطلب غير موجود', 'error');
                    return;
                }
                
                const order = doc.data();
                
                // الحصول على بيانات العميل
                let customerName = 'غير معروف';
                let customerPhone = '';
                if (order.customerId) {
                    const customerDoc = await db.collection('customers').doc(order.customerId).get();
                    if (customerDoc.exists) {
                        const customer = customerDoc.data();
                        customerName = customer.name;
                        customerPhone = customer.phone;
                    }
                }
                
                const date = order.date ? new Date(order.date.seconds * 1000) : new Date();
                const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                
                // بناء قائمة المنتجات
                let productsHtml = '';
                order.products.forEach(product => {
                    productsHtml += `
                        <tr>
                            <td>${product.productName}</td>
                            <td>${product.batchName}</td>
                            <td>${Number(product.price).toLocaleString()} ج.م</td>
                            <td>${product.quantity}</td>
                            <td>${Number(product.total).toLocaleString()} ج.م</td>
                        </tr>
                    `;
                });
                
                // عرض التفاصيل في SweetAlert
                Swal.fire({
                    title: `تفاصيل الطلب: ${order.orderId || orderId}`,
                    html: `
                        <div class="text-right">
                            <p><strong>التاريخ:</strong> ${formattedDate}</p>
                            <p><strong>العميل:</strong> ${customerName}</p>
                            <p><strong>رقم الهاتف:</strong> ${customerPhone}</p>
                            <p><strong>طريقة الدفع:</strong> ${order.paymentMethod || '-'}</p>
                            
                            ${order.notes ? `<p><strong>ملاحظات:</strong> ${order.notes}</p>` : ''}
                            
                            <div class="mt-4">
                                <table class="w-full border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="border p-2 text-right">المنتج</th>
                                            <th class="border p-2 text-right">الباتش/اللون</th>
                                            <th class="border p-2 text-right">السعر</th>
                                            <th class="border p-2 text-right">الكمية</th>
                                            <th class="border p-2 text-right">الإجمالي</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${productsHtml}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="mt-4 text-left">
                                <p><strong>المبلغ قبل الخصم:</strong> ${Number(order.subtotal || 0).toLocaleString()} ج.م</p>
                                <p><strong>الخصم (${order.discountPercent || 0}%):</strong> ${Number(order.discountAmount || 0).toLocaleString()} ج.م</p>
                                
                                ${order.deposit > 0 ? `<p><strong>العربون (${order.depositMethod}):</strong> ${Number(order.deposit).toLocaleString()} ج.م</p>` : ''}
                                
                                <p class="text-xl mt-2"><strong>المبلغ النهائي:</strong> ${Number(order.totalAfterDiscount || 0).toLocaleString()} ج.م</p>
                            </div>
                        </div>
                    `,
                    width: 800,
                    confirmButtonText: 'إغلاق',
                    confirmButtonColor: '#5D5CDE'
                });
                
            } catch (error) {
                console.error("Error viewing order: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء تحميل بيانات الطلب', 'error');
            }
        }
        
        // طباعة الفاتورة
        async function printOrder(orderId) {
            try {
                const doc = await db.collection('orders').doc(orderId).get();
                if (!doc.exists) {
                    showAlert('خطأ', 'الطلب غير موجود', 'error');
                    return;
                }
                
                const order = doc.data();
                
                // الحصول على بيانات العميل
                let customerName = 'غير معروف';
                let customerPhone = '';
                let customerAddress = '';
                
                if (order.customerId) {
                    const customerDoc = await db.collection('customers').doc(order.customerId).get();
                    if (customerDoc.exists) {
                        const customer = customerDoc.data();
                        customerName = customer.name;
                        customerPhone = customer.phone;
                        customerAddress = customer.address || '';
                    }
                }
                
                const date = order.date ? new Date(order.date.seconds * 1000) : new Date();
                const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                
                // بناء صفحة HTML للطباعة
                const printWindow = window.open('', '_blank');
                
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html dir="rtl">
                    <head>
                        <title>فاتورة رقم ${order.orderId || orderId}</title>
                        <meta charset="UTF-8">
                        <style>
                            body {
                                font-family: Arial, sans-serif;
                                margin: 0;
                                padding: 20px;
                                direction: rtl;
                            }
                            .invoice-header {
                                text-align: center;
                                margin-bottom: 30px;
                            }
                            .invoice-header h1 {
                                margin: 0;
                                color: #5D5CDE;
                            }
                            .invoice-details {
                                display: flex;
                                justify-content: space-between;
                                margin-bottom: 30px;
                            }
                            .invoice-details div {
                                flex: 1;
                            }
                            .customer-details {
                                text-align: right;
                            }
                            .invoice-info {
                                text-align: left;
                            }
                            table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-bottom: 30px;
                            }
                            th, td {
                                border: 1px solid #ddd;
                                padding: 10px;
                                text-align: right;
                            }
                            th {
                                background-color: #f2f2f2;
                            }
                            .totals {
                                text-align: left;
                                margin-bottom: 30px;
                            }
                            .totals p {
                                margin: 5px 0;
                            }
                            .grand-total {
                                font-size: 18px;
                                font-weight: bold;
                                margin-top: 10px;
                            }
                            .notes {
                                margin-top: 30px;
                                border-top: 1px solid #ddd;
                                padding-top: 20px;
                            }
                            .footer {
                                margin-top: 50px;
                                text-align: center;
                                font-size: 12px;
                                color: #777;
                            }
                            @media print {
                                .no-print {
                                    display: none;
                                }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="invoice-header">
                            <h1>فاتورة مبيعات</h1>
                            <p>شركة دهانات دلتا Delta HCP</p>
                        </div>
                        
                        <div class="invoice-details">
                            <div class="customer-details">
                                <h3>بيانات العميل</h3>
                                <p><strong>الاسم:</strong> ${customerName}</p>
                                <p><strong>رقم الهاتف:</strong> ${customerPhone}</p>
                                ${customerAddress ? `<p><strong>العنوان:</strong> ${customerAddress}</p>` : ''}
                            </div>
                            
                            <div class="invoice-info">
                                <h3>بيانات الفاتورة</h3>
                                <p><strong>رقم الفاتورة:</strong> ${order.orderId || orderId}</p>
                                <p><strong>التاريخ:</strong> ${formattedDate}</p>
                                <p><strong>طريقة الدفع:</strong> ${order.paymentMethod || '-'}</p>
                            </div>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>المنتج</th>
                                    <th>الباتش/اللون</th>
                                    <th>السعر</th>
                                    <th>الكمية</th>
                                    <th>الإجمالي</th>
                                </tr>
                            </thead>
                            <tbody>
                `);
                
                // إضافة صفوف المنتجات
                order.products.forEach((product, index) => {
                    printWindow.document.write(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${product.productName}</td>
                            <td>${product.batchName}</td>
                            <td>${Number(product.price).toLocaleString()} ج.م</td>
                            <td>${product.quantity}</td>
                            <td>${Number(product.total).toLocaleString()} ج.م</td>
                        </tr>
                    `);
                });
                
                printWindow.document.write(`
                            </tbody>
                        </table>
                        
                        <div class="totals">
                            <p><strong>المبلغ قبل الخصم:</strong> ${Number(order.subtotal || 0).toLocaleString()} ج.م</p>
                            <p><strong>الخصم (${order.discountPercent || 0}%):</strong> ${Number(order.discountAmount || 0).toLocaleString()} ج.م</p>
                            
                            ${order.deposit > 0 ? `<p><strong>العربون (${order.depositMethod}):</strong> ${Number(order.deposit).toLocaleString()} ج.م</p>` : ''}
                            
                            <p class="grand-total"><strong>المبلغ النهائي:</strong> ${Number(order.totalAfterDiscount || 0).toLocaleString()} ج.م</p>
                        </div>
                        
                        ${order.notes ? `
                        <div class="notes">
                            <h3>ملاحظات</h3>
                            <p>${order.notes}</p>
                        </div>
                        ` : ''}
                        
                        <div class="footer">
                            <p>شكرًا لتعاملكم معنا!</p>
                            <p>Delta HCP - شركة دهانات دلتا</p>
                        </div>
                        
                        <div class="no-print" style="text-align: center; margin-top: 30px;">
                            <button onclick="window.print()" style="padding: 10px 20px; background-color: #5D5CDE; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                طباعة الفاتورة
                            </button>
                        </div>
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                
            } catch (error) {
                console.error("Error printing order: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء طباعة الفاتورة', 'error');
            }
        }
        
        // حذف طلب
        async function deleteOrder(orderId) {
            try {
                const result = await Swal.fire({
                    title: 'هل أنت متأكد؟',
                    text: 'سيتم حذف هذا الطلب نهائيًا!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'نعم، احذف',
                    cancelButtonText: 'إلغاء'
                });
                
                if (result.isConfirmed) {
                    await db.collection('orders').doc(orderId).delete();
                    showAlert('تم الحذف', 'تم حذف الطلب بنجاح', 'success');
                    loadOrders();
                    loadRecentOrders();
                }
            } catch (error) {
                console.error("Error deleting order: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء حذف الطلب', 'error');
            }
        }
        
        // حذف عميل
        async function deleteCustomer(customerId) {
            try {
                const result = await Swal.fire({
                    title: 'هل أنت متأكد؟',
                    text: 'سيتم حذف هذا العميل نهائيًا! تأكد من عدم وجود طلبات مرتبطة به.',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'نعم، احذف',
                    cancelButtonText: 'إلغاء'
                });
                
                if (result.isConfirmed) {
                    // التحقق من وجود طلبات مرتبطة بالعميل
                    const ordersQuery = await db.collection('orders').where('customerId', '==', customerId).limit(1).get();
                    
                    if (!ordersQuery.empty) {
                        showAlert('تعذر الحذف', 'لا يمكن حذف العميل لوجود طلبات مرتبطة به.', 'error');
                        return;
                    }
                    
                    await db.collection('customers').doc(customerId).delete();
                    showAlert('تم الحذف', 'تم حذف العميل بنجاح', 'success');
                    loadCustomers();
                }
            } catch (error) {
                console.error("Error deleting customer: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء حذف العميل', 'error');
            }
        }
        
        // تعديل بيانات العميل
        async function editCustomer(customerId) {
            try {
                const doc = await db.collection('customers').doc(customerId).get();
                if (!doc.exists) {
                    showAlert('خطأ', 'العميل غير موجود', 'error');
                    return;
                }
                
                const customer = doc.data();
                
                // تعديل موديل إضافة العميل ليصبح للتعديل
                document.getElementById('customer-name').value = customer.name;
                document.getElementById('customer-phone').value = customer.phone;
                document.getElementById('customer-address').value = customer.address || '';
                document.getElementById('customer-category').value = customer.category || '';
                document.getElementById('customer-discount').value = customer.discount || 0;
                
                // تغيير نص زر الحفظ
                const saveButton = document.getElementById('save-customer-button');
                saveButton.textContent = 'تحديث العميل';
                
                // تغيير العنوان
                document.querySelector('#add-customer-modal h3').textContent = 'تعديل بيانات العميل';
                
                // إضافة معرف العميل كسمة للزر
                saveButton.setAttribute('data-id', customerId);
                
                // تغيير وظيفة زر الحفظ للتعديل بدلاً من الإضافة
                saveButton.removeEventListener('click', saveButton.clickHandler);
                saveButton.clickHandler = async () => {
                    const name = document.getElementById('customer-name').value;
                    const phone = document.getElementById('customer-phone').value;
                    const address = document.getElementById('customer-address').value;
                    const category = document.getElementById('customer-category').value;
                    const discount = parseFloat(document.getElementById('customer-discount').value || 0);
                    
                    if (!name || !phone) {
                        showAlert('خطأ', 'يرجى إدخال اسم العميل ورقم الهاتف على الأقل', 'error');
                        return;
                    }
                    
                    if (discount < 0 || discount > 100) {
                        showAlert('خطأ', 'نسبة الخصم يجب أن تكون بين 0 و 100', 'error');
                        return;
                    }
                    
                    try {
                        await db.collection('customers').doc(customerId).update({
                            name,
                            phone,
                            address,
                            category,
                            discount,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        showAlert('تم بنجاح', 'تم تحديث بيانات العميل بنجاح', 'success');
                        
                        // إعادة تحميل العملاء وإغلاق الموديل
                        loadCustomers();
                        closeModal('add-customer-modal');
                        
                        // إعادة تعيين الموديل
                        resetCustomerModal();
                        
                    } catch (error) {
                        console.error("Error updating customer: ", error);
                        showAlert('خطأ', 'حدث خطأ أثناء تحديث بيانات العميل', 'error');
                    }
                };
                
                saveButton.addEventListener('click', saveButton.clickHandler);
                
                // فتح الموديل
                openModal('add-customer-modal');
                
            } catch (error) {
                console.error("Error editing customer: ", error);
                showAlert('خطأ', 'حدث خطأ أثناء تحميل بيانات العميل', 'error');
            }
        }
        
        // إعادة تعيين موديل العميل
        function resetCustomerModal() {
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('customer-address').value = '';
            document.getElementById('customer-category').value = '';
            document.getElementById('customer-discount').value = '';
            
            const saveButton = document.getElementById('save-customer-button');
            saveButton.textContent = 'حفظ العميل';
            saveButton.removeAttribute('data-id');
            
            document.querySelector('#add-customer-modal h3').textContent = 'إضافة عميل جديد';
            
            // إعادة مستمع الإضافة الافتراضي
            if (saveButton.clickHandler) {
                saveButton.removeEventListener('click', saveButton.clickHandler);
            }
            
            saveButton.addEventListener('click', async () => {
                const name = document.getElementById('customer-name').value;
                const phone = document.getElementById('customer-phone').value;
                const address = document.getElementById('customer-address').value;
                const category = document.getElementById('customer-category').value;
                const discount = parseFloat(document.getElementById('customer-discount').value || 0);
                
                if (!name || !phone) {
                    showAlert('خطأ', 'يرجى إدخال اسم العميل ورقم الهاتف على الأقل', 'error');
                    return;
                }
                
                if (discount < 0 || discount > 100) {
                    showAlert('خطأ', 'نسبة الخصم يجب أن تكون بين 0 و 100', 'error');
                    return;
                }
                
                try {
                    // التحقق من وجود عميل بنفس رقم الهاتف
                    const existingCustomer = await db.collection('customers')
                        .where('phone', '==', phone)
                        .get();
                    
                    if (!existingCustomer.empty) {
                        showAlert('تحذير', 'يوجد عميل بنفس رقم الهاتف بالفعل!', 'warning');
                        return;
                    }
                    
                    // إضافة العميل الجديد
                    await db.collection('customers').add({
                        name,
                        phone,
                        address,
                        category,
                        discount,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showAlert('تم بنجاح', 'تم إضافة العميل بنجاح', 'success');
                    
                    // إعادة تحميل العملاء وإغلاق الموديل
                    loadCustomers();
                    closeModal('add-customer-modal');
                    
                    // مسح حقول الموديل
                    document.getElementById('customer-name').value = '';
                    document.getElementById('customer-phone').value = '';
                    document.getElementById('customer-address').value = '';
                    document.getElementById('customer-category').value = '';
                    document.getElementById('customer-discount').value = '';
                    
                } catch (error) {
                    console.error("Error adding customer: ", error);
                    showAlert('خطأ', 'حدث خطأ أثناء إضافة العميل', 'error');
                }
            });
        }
        
        // البحث في المنتجات
        document.getElementById('product-search-button').addEventListener('click', () => {
            const searchName = document.getElementById('product-search').value.trim().toLowerCase();
            const searchCategory = document.getElementById('product-category-filter').value;
            
            const productsTable = document.getElementById('products-table');
            const rows = productsTable.querySelectorAll('tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length) {
                    const name = cells[0].textContent.toLowerCase();
                    const category = cells[1].textContent;
                    
                    const nameMatch = !searchName || name.includes(searchName);
                    const categoryMatch = !searchCategory || category === searchCategory;
                    
                    if (nameMatch && categoryMatch) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        });
        
        // إعادة تعيين البحث في المنتجات
        document.getElementById('product-reset-button').addEventListener('click', () => {
            document.getElementById('product-search').value = '';
            document.getElementById('product-category-filter').value = '';
            
            const productsTable = document.getElementById('products-table');
            const rows = productsTable.querySelectorAll('tr');
            
            rows.forEach(row => {
                row.style.display = '';
            });
        });
        
        // البحث في الطلبات
        document.getElementById('order-search-button').addEventListener('click', async () => {
            const orderId = document.getElementById('order-id-search').value.trim();
            const customerName = document.getElementById('order-customer-search').value.trim().toLowerCase();
            const productName = document.getElementById('order-product-search').value.trim().toLowerCase();
            const dateFrom = document.getElementById('order-date-from').value;
            const dateTo = document.getElementById('order-date-to').value;
            
            try {
                const ordersTable = document.getElementById('orders-table');
                ordersTable.innerHTML = '<tr><td colspan="8" class="py-4 text-center">جاري البحث...</td></tr>';
                
                let query = db.collection('orders');
                
                // الفلترة حسب التاريخ إذا تم تحديده
                if (dateFrom && dateTo) {
                    const fromDate = new Date(dateFrom);
                    const toDate = new Date(dateTo);
                    toDate.setDate(toDate.getDate() + 1); // لتضمين اليوم المحدد
                    
                    query = query.where('date', '>=', firebase.firestore.Timestamp.fromDate(fromDate))
                              .where('date', '<', firebase.firestore.Timestamp.fromDate(toDate));
                } else if (dateFrom) {
                    const fromDate = new Date(dateFrom);
                    query = query.where('date', '>=', firebase.firestore.Timestamp.fromDate(fromDate));
                } else if (dateTo) {
                    const toDate = new Date(dateTo);
                    toDate.setDate(toDate.getDate() + 1); // لتضمين اليوم المحدد
                    query = query.where('date', '<', firebase.firestore.Timestamp.fromDate(toDate));
                }
                
                // تنفيذ الاستعلام
                const snapshot = await query.orderBy('date', 'desc').get();
                
                if (snapshot.empty) {
                    ordersTable.innerHTML = '<tr><td colspan="8" class="py-4 text-center text-gray-500">لا توجد نتائج للبحث</td></tr>';
                    return;
                }
                
                const ordersPromises = snapshot.docs.map(async doc => {
                    const order = doc.data();
                    
                    // الفلترة حسب رقم الطلب
                    if (orderId && !(order.orderId || doc.id).includes(orderId)) {
                        return null;
                    }
                    
                    // الحصول على بيانات العميل
                    let customerData = { name: 'غير معروف' };
                    if (order.customerId) {
                        const customerDoc = await db.collection('customers').doc(order.customerId).get();
                        if (customerDoc.exists) {
                            customerData = customerDoc.data();
                        }
                    }
                    
                    // الفلترة حسب اسم العميل
                    if (customerName && !customerData.name.toLowerCase().includes(customerName)) {
                        return null;
                    }
                    
                    // الفلترة حسب اسم المنتج
                    if (productName) {
                        const hasMatchingProduct = order.products?.some(product => 
                            product.productName.toLowerCase().includes(productName)
                        );
                        
                        if (!hasMatchingProduct) {
                            return null;
                        }
                    }
                    
                    const date = order.date ? new Date(order.date.seconds * 1000) : new Date();
                    const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                    
                    return `
                        <tr class="border-b hover:bg-gray-50 dark:hover:bg-gray-700">
                            <td class="py-3 px-4">${order.orderId || doc.id}</td>
                            <td class="py-3 px-4">${customerData.name}</td>
                            <td class="py-3 px-4">${formattedDate}</td>
                            <td class="py-3 px-4">${Number(order.subtotal || 0).toLocaleString()} ج.م</td>
                            <td class="py-3 px-4">${Number(order.discountAmount || 0).toLocaleString()} ج.م (${order.discountPercent || 0}%)</td>
                            <td class="py-3 px-4">${Number(order.totalAfterDiscount || 0).toLocaleString()} ج.م</td>
                            <td class="py-3 px-4">${order.paymentMethod || '-'}</td>
                            <td class="py-3 px-4">
                                <button class="view-order mr-2 text-green-500" data-id="${doc.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="print-order mr-2 text-blue-500" data-id="${doc.id}">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button class="delete-order text-red-500" data-id="${doc.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                const ordersHtmlArray = await Promise.all(ordersPromises);
                const filteredOrdersHtml = ordersHtmlArray.filter(html => html !== null);
                
                if (filteredOrdersHtml.length === 0) {
                    ordersTable.innerHTML = '<tr><td colspan="8" class="py-4 text-center text-gray-500">لا توجد نتائج للبحث</td></tr>';
                    return;
                }
                
                ordersTable.innerHTML = filteredOrdersHtml.join('');
                
                // إضافة مستمعي الأحداث لأزرار المشاهدة والطباعة والحذف
                document.querySelectorAll('.view-order').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = e.currentTarget.getAttribute('data-id');
                        viewOrder(orderId);
                    });
                });
                
                document.querySelectorAll('.print-order').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = e.currentTarget.getAttribute('data-id');
                        printOrder(orderId);
                    });
                });
                
                document.querySelectorAll('.delete-order').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = e.currentTarget.getAttribute('data-id');
                        deleteOrder(orderId);
                    });
                });
                
            } catch (error) {
                console.error("Error searching orders: ", error);
                document.getElementById('orders-table').innerHTML = '<tr><td colspan="8" class="py-4 text-center text-red-500">حدث خطأ أثناء البحث</td></tr>';
            }
        });
        
        // إعادة تعيين البحث في الطلبات
        document.getElementById('order-reset-button').addEventListener('click', () => {
            document.getElementById('order-id-search').value = '';
            document.getElementById('order-customer-search').value = '';
            document.getElementById('order-product-search').value = '';
            document.getElementById('order-date-from').value = '';
            document.getElementById('order-date-to').value = '';
            
            loadOrders();
        });
    </script>
</body>
</html>
